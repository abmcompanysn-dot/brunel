<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tableau de Bord</title>
    <style>
        :root {
            --blue: #007bff;
            --red: #dc3545;
            --dark-card: rgba(30, 30, 30, 0.85);
            --text-light: #f8f9fa;
            --text-secondary: #adb5bd;
            --border-color: #444;
            --sidebar-width-collapsed: 80px;
            --sidebar-width-expanded: 260px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            background: linear-gradient(120deg, var(--blue) 0%, var(--red) 100%);
            background-attachment: fixed;
            color: var(--text-light);
        }

        .dashboard-layout {
            display: flex;
        }

        /* Barre latérale */
        .sidebar {
            width: var(--sidebar-width-expanded);
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            background-color: var(--dark-card);
            backdrop-filter: blur(10px);
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between; /* Pour pousser la déconnexion en bas */
            z-index: 100;
        }

        .sidebar.collapsed {
            width: var(--sidebar-width-collapsed);
            align-items: center;
        }

        .sidebar h2 {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px 10px;
            height: 70px; /* Hauteur fixe pour l'alignement */
        }

        .sidebar h2 img {
            transition: transform 0.3s ease;
        }
        .sidebar h2:hover img {
            transform: scale(1.05);
        }

        .sidebar nav a {
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--text-secondary);
            text-decoration: none;
            padding: 15px 25px;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: background-color 0.3s, color 0.3s;
            font-weight: 500;
        }

        .sidebar nav a svg {
            width: 24px;
            height: 24px;
            stroke-width: 2;
        }

        .sidebar nav a:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
        }

        .sidebar nav a.active {
            background: linear-gradient(90deg, var(--blue), var(--red));
            color: white;
            font-weight: bold;
        }

        .sidebar.collapsed nav a {
            justify-content: center; /* Centre l'icône quand replié */
        }

        .sidebar.collapsed nav a span {
            display: none; /* Cache le texte quand replié */
        }

        /* Contenu principal */
        .main-content {
            margin-left: var(--sidebar-width-expanded);
            flex-grow: 1;
            padding: 40px;
            box-sizing: border-box;
            transition: margin-left 0.3s ease;
        }

        .menu-toggle.moved {
            left: calc(var(--sidebar-width) + 20px);
        }

        /* Cartes de contenu */
        .card {
            background-color: var(--dark-card);
            backdrop-filter: blur(5px);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }

        .card h3 {
            margin-top: 0;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        /* Styles spécifiques au Dashboard */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; }
        .stat-item { text-align: center; }
        .stat-item .number { font-size: 2.5em; font-weight: bold; color: var(--text-light); }
        .stat-item .label { color: var(--text-secondary); }
        .toggle-switch { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; border-bottom: 1px solid var(--border-color); text-align: left; }
        th { background-color: rgba(0,0,0,0.2); }
        .btn { padding: 10px 15px; border-radius: 5px; border: none; cursor: pointer; font-weight: 600; }
        .btn-primary { background-color: var(--blue); color: white; }
        .btn-secondary { background-color: var(--text-secondary); color: var(--dark-card); }

        /* Styles pour les onglets de contenu */
        .content-pane {
            display: none; /* Cacher tous les panneaux par défaut */
        }
        .content-pane.active {
            display: block; /* Afficher seulement le panneau actif */
        }

        /* Styles du formulaire de l'éditeur */
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 8px; color: var(--text-secondary); }
        .form-control {
            width: 100%; padding: 12px; background-color: rgba(0,0,0,0.2);
            border: 1px solid var(--border-color); border-radius: 5px;
            color: var(--text-light); font-size: 1em; box-sizing: border-box; transition: border-color 0.3s;
        }
        .form-control:focus {
            outline: none;
            border-color: var(--blue);
        }
        textarea.form-control { min-height: 120px; resize: vertical; }

        .social-link-entry {
            display: grid;
            grid-template-columns: 1fr 2fr auto;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        .btn-danger { background-color: #555; color: white; padding: 8px 12px; font-size: 0.9em; }
        .btn-danger:hover { background-color: var(--red); }

        /* Nouveaux styles pour le panneau Profil */
        .profile-preview-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
        }
        .profile-main-card {
            position: relative;
            padding: 0;
            overflow: hidden;
        }
        .profile-cover-image {
            width: 100%;
            height: 200px;
            background-color: #333;
            background-size: cover;
            background-position: center;
        }
        .profile-picture-container {
            position: relative;
            margin-top: -60px;
            padding: 0 25px;
        }
        .profile-picture-container img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid var(--dark-card);
            object-fit: cover;
        }
        .profile-info {
            padding: 15px 25px 25px 25px;
        }
        .profile-info h2 { margin: 0 0 10px 0; }
        .profile-info p { margin: 0; color: var(--text-secondary); }

        .share-actions .btn {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            justify-content: center;
        }

        .progress-bar-container {
            margin-bottom: 20px;
        }
        .progress-bar {
            width: 100%; background-color: #333; border-radius: 5px; overflow: hidden;
        }
        .progress-bar-inner {
            height: 10px; width: 0%; /* Défini par JS */
            background: linear-gradient(90deg, var(--blue), var(--red));
            transition: width 0.5s ease;
        }

        /* Nouveaux styles pour la fenêtre modale */
        .modal {
            display: none; /* Caché par défaut */
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: var(--dark-card);
            margin: 5% auto;
            padding: 30px;
            border: 1px solid var(--border-color);
            width: 80%;
            max-width: 1100px; /* Augmenté pour la nouvelle interface */
            border-radius: 12px;
            animation: slideIn 0.4s;
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .close-btn {
            color: var(--text-secondary); float: right; font-size: 28px; font-weight: bold; cursor: pointer;
        }
        
        /* Nouveaux styles pour l'éditeur de profil modal */
        .modal-editor-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        .editor-nav {
            display: flex;
            gap: 10px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }
        .editor-nav-btn {
            padding: 10px 15px;
            cursor: pointer;
            border: none;
            background: none;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
        }
        .editor-nav-btn.active {
            color: var(--text-light);
            border-bottom-color: var(--blue);
        }
        .edit-pane { display: none; }
        .edit-pane.active { display: block; }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        /* Styles pour le simulateur de téléphone */
        .phone-preview {
            background-color: #111;
            border-radius: 40px;
            padding: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            height: fit-content;
        }
        .phone-screen {
            background-color: var(--dark-card);
            height: 600px;
            border-radius: 25px;
            overflow-y: auto;
            position: relative;
        }
        .phone-header { text-align: center; padding: 20px; }
        .phone-header img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--blue);
            object-fit: cover;
        }
        .phone-header h3 { margin: 10px 0 5px 0; font-size: 1.2em; }
        .phone-header p { margin: 0; font-size: 0.9em; color: var(--text-secondary); }
        
        /* Scrollbar pour le téléphone */
        .phone-screen::-webkit-scrollbar { width: 4px; }
        .phone-screen::-webkit-scrollbar-track { background: transparent; }
        .phone-screen::-webkit-scrollbar-thumb { background: #555; border-radius: 2px; }
        .phone-screen::-webkit-scrollbar-thumb:hover { background: #777; }

        .phone-cover { height: 120px; background-size: cover; background-position: center; }

        .phone-social-links {
            padding: 0 20px 20px 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .phone-social-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px;
            background-color: rgba(0,0,0,0.2);
            border-radius: 8px;
            text-decoration: none;
            color: var(--text-secondary);
        }
        .phone-social-link img.social-icon { /* Cible pour les nouvelles icônes SVG */
            width: 20px;
            height: 20px;
            filter: invert(1); /* Assure que les icônes sont blanches par défaut */
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(calc(-1 * var(--sidebar-width-expanded)));
                transition: transform 0.3s ease;
            }
            .sidebar.visible {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0 !important;
            }
            .sidebar { transform: translateX(calc(-1 * var(--sidebar-width-expanded))); }
            .sidebar.visible { transform: translateX(0); }
            .main-content.collapsed, .main-content { margin-left: 0 !important; }
            .main-content { padding: 20px; }
            .menu-toggle { left: 20px !important; transform: translateX(0); }
            .profile-preview-grid {
                grid-template-columns: 1fr;
            }
            .modal-editor-layout {
                grid-template-columns: 1fr;
            }
            .modal-content {
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-layout">
        <div class="menu-toggle" onclick="toggleSidebar()">☰</div>
        <aside class="sidebar">
            <h2><img src="r/logo.png" alt="Logo Brunel" style="height: 70px;"></h2>
            <nav>
                <a href="#" class="active" onclick="showPane('profil-content', this)" title="Profil">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                    <span>Profil</span>
                </a>
                <a href="#" onclick="showPane('contact-content', this)" title="Contacts">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                    <span>Contacts</span>
                </a>
                <a href="#" onclick="showPane('statistique-content', this)" title="Statistiques">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
                    <span>Statistiques</span>
                </a>
                <a href="#" onclick="showPane('integration-content', this)" title="Intégrations">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"></path></svg>
                    <span>Intégrations</span>
                </a>
                <a href="Boutique.html" title="Boutique">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                    <span>Boutique</span>
                </a>
                <a href="#" onclick="showPane('parametre-content', this)" title="Paramètres">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="21" x2="4" y2="14"></line><line x1="4" y1="10" x2="4" y2="3"></line><line x1="12" y1="21" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="3"></line><line x1="20" y1="21" x2="20" y2="16"></line><line x1="20" y1="12" x2="20" y2="3"></line><line x1="1" y1="14" x2="7" y2="14"></line><line x1="9" y1="8" x2="15" y2="8"></line><line x1="17" y1="16" x2="23" y2="16"></line></svg>
                    <span>Paramètres</span>
                </a>
            </nav>
            <nav> <!-- Conteneur séparé pour le bouton de déconnexion -->
                <a href="#" onclick="logout()" title="Déconnexion">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                    <span>Déconnexion</span>
                </a>
            </nav>
        </aside>

        <main class="main-content">
            <!-- Panneau Profil (Aperçu) -->
            <div id="profil-content" class="content-pane active">
                <h1>Profil</h1>
                <div class="progress-bar-container">
                    <p>Complétion du profil : <span id="profile-completeness-percent">...</span></p>
                    <div class="progress-bar"><div id="profile-completeness-bar" class="progress-bar-inner"></div></div>
                </div>
                <div class="profile-preview-grid">
                    <!-- Colonne principale -->
                    <div class="profile-main-column">
                        <div class="card profile-main-card">
                            <div id="profile-cover-preview" class="profile-cover-image" style="background-image: url('https://via.placeholder.com/800x300?text=Couverture');"></div>
                            <div class="profile-picture-container">
                                <img id="profile-picture-preview" src="https://via.placeholder.com/150" alt="Photo de profil">
                            </div>
                            <div class="profile-info">
                                <h2 id="profile-name-preview">Nom Prénom</h2>
                                <p id="profile-details-preview">Profession | Entreprise | Lieu</p>
                                <button class="btn btn-primary" style="margin-top: 20px;" onclick="openModal('profil-edit-modal')">Modifier le Profil</button>
                            </div>
                    </div>
                    <!-- Colonne latérale -->
                    <div class="profile-sidebar-column">
                        <div class="card">
                            <h3>QR Code</h3>
                            <img id="profile-qrcode" src="https://via.placeholder.com/150?text=Chargement" alt="QR Code" style="width: 100%; height: auto; border-radius: 8px;">
                            <a id="download-qrcode-btn" href="#" class="btn btn-secondary" download="qrcode-mahu.png" style="margin-top: 15px; width:100%; box-sizing: border-box;">Télécharger (HD)</a>
                        </div>
                        <div class="card share-actions">
                            <h3>Partager le Profil</h3>
                            <a id="share-link" href="#" class="btn btn-secondary">Copier le lien</a>
                            <a id="share-email" href="#" class="btn btn-secondary">Partager par Email</a>
                            <a id="share-sms" href="#" class="btn btn-secondary">Partager par SMS</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Panneau Contacts -->
            <div id="contact-content" class="content-pane">
                <h1>Contacts</h1>
                <div class="card">
                    <h3>Mes Prospects</h3>
                    <button class="btn btn-secondary" style="float: right; margin-bottom: 15px;" onclick="exportLeads()">Exporter en CSV</button>
                    <div style="overflow-x:auto;">
                        <table>
                        <thead>
                            <tr>
                                <th>Nom du Prospect</th>
                                <th>Contact (Email/Tél)</th>
                                <th>Date</th>
                                <th>Note</th>
                            </tr>
                        </thead>
                        <tbody id="prospects-table-body">
                            <tr><td colspan="4" style="text-align: center;">Chargement des prospects...</td></tr>
                        </tbody>
                    </table>
                    </div>
                </div>
            </div>

            <!-- Panneau Statistiques -->
            <div id="statistique-content" class="content-pane">
                <h1>Statistiques</h1>
                <div class="card">
                    <h3>Statistiques</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="number">...</div>
                            <div class="label">Vues Totales</div>
                        </div>
                        <div class="stat-item">
                            <div class="number">...</div>
                            <div class="label">Vues via NFC</div>
                        </div>
                        <div class="stat-item">
                            <div class="number">...</div>
                            <div class="label">Vues via QR Code</div>
                        </div>
                        <div class="stat-item">
                            <div class="number">...</div>
                            <div class="label">Vues via Lien</div>
                        </div>
                    </div>
                    <canvas id="viewsChart" style="margin-top: 20px;"></canvas>
                </div>
            </div>

            <!-- Panneau Intégrations -->
            <div id="integration-content" class="content-pane">
                <h1>Intégrations</h1>
                <p class="section-subtitle" style="max-width: 100%; text-align: left; margin-bottom: 20px;">Connectez Mahu à d'autres services. Les clés API sont stockées de manière sécurisée et ne sont jamais partagées publiquement.</p>
                
                <div class="card">
                    <h3>Google Wallet</h3>
                    <p>Remplissez ces informations depuis votre <a href="https://pay.google.com/business/console" target="_blank">console Google Pay & Wallet</a> pour activer le bouton "Ajouter à Google Wallet".</p>
                    <div class="form-group"><label for="wallet-issuer-id">ID de l'émetteur (Issuer ID)</label><input type="text" id="wallet-issuer-id" class="form-control"></div>
                    <div class="form-group"><label for="wallet-class-id">ID de la classe (Class ID)</label><input type="text" id="wallet-class-id" class="form-control"></div>
                    <div class="form-group"><label for="wallet-service-email">Email du compte de service</label><input type="text" id="wallet-service-email" class="form-control"></div>
                    <div class="form-group"><label for="wallet-private-key">Clé privée du compte de service</label><textarea id="wallet-private-key" class="form-control" rows="4"></textarea></div>
                </div>
            </div>

            <!-- Panneau Paramètres -->
            <div id="parametre-content" class="content-pane">
                <h1>Paramètres</h1>
                <div class="card">
                    <h3>Mon Compte</h3>
                    <p>Email du compte : <strong id="account-email">Chargement...</strong></p>
                    <button class="btn btn-secondary" style="margin-top: 15px;">Changer le mot de passe (à venir)</button>
                </div>
                <div class="card">
                    <h3>Gestion des Modules</h3>
                    <div class="toggle-switch">
                        <span>Activer le module CV/Portfolio</span>
                        <input type="checkbox" id="toggle-cv" onchange="toggleModule('CV_Actif', this.checked)">
                    </div>
                    <div class="toggle-switch">
                        <span>Activer la capture de prospects</span>
                        <input type="checkbox" id="toggle-lead" onchange="toggleModule('Lead_Capture_Actif', this.checked)">
                    </div>
                </div>

                <div class="card">
                    <h3>Votre Carte Numérique (Wallet)</h3>
                    <p>Ajoutez votre carte de visite Mahu à votre portefeuille numérique pour un accès rapide et facile.</p>
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button id="apple-wallet-btn" class="btn" onclick="addToAppleWallet()" style="flex: 1;">Ajouter à Apple Wallet</button>
                        <button id="google-wallet-btn" class="btn" onclick="addToGoogleWallet()" style="flex: 1;">Ajouter à Google Wallet</button>
                    </div>
                </div>

                <div class="card">
                    <h3>Mes Cartes NFC</h3>
                    <ul id="nfc-card-list">
                        <li>Chargement des cartes...</li>
                    </ul>
                    <button class="btn btn-primary" onclick="linkNewNFC()" style="margin-top: 15px;">Lier une nouvelle carte</button>
                </div>

                <div class="card">
                    <h3>Demande de Carte</h3>
                    <p><strong>Statut de la dernière commande :</strong> <span id="order-status">Aucune commande récente.</span></p>
                    <button class="btn btn-primary" onclick="window.location.href='Boutique.html'" style="margin-top: 15px;">Commander une nouvelle carte</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Fenêtre Modale pour l'édition du profil -->
    <div id="profil-edit-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('profil-edit-modal')">&times;</span>
            <h1>Modifier le Profil</h1>
            <div class="editor-nav">
                <button class="editor-nav-btn active" onclick="showEditPane('edit-pane-about', this)">À propos</button>
                <button class="editor-nav-btn" onclick="showEditPane('edit-pane-appearance', this)">Apparence</button>
                <button class="editor-nav-btn" onclick="showEditPane('edit-pane-links', this)">Liens</button>
                <button class="editor-nav-btn" onclick="showEditPane('edit-pane-modules', this)">Modules</button>
            </div>
            <div class="modal-editor-layout">
                <form id="profile-form" onsubmit="handleSave(event)">
                    <!-- Panneau d'édition "À propos" -->
                    <div id="edit-pane-about" class="edit-pane active">
                        <h3>Contenu Principal</h3>
                        <div class="form-group"><label for="Nom_Complet">Nom complet</label><input type="text" id="Nom_Complet" name="Nom_Complet" class="form-control" placeholder="Ex: Jean Dupont"></div>
                        <div class="form-group"><label for="URL_Profil">URL du profil personnalisée</label><input type="text" id="URL_Profil" name="URL_Profil" class="form-control" placeholder="Ex: jean-dupont (lettres, chiffres et tirets uniquement)"></div>
                        <div class="form-group"><label for="Profession">Profession</label><input type="text" id="Profession" name="Profession" class="form-control" placeholder="Ex: Développeur Web"></div>
                        <div class="form-group"><label for="Compagnie">Compagnie</label><input type="text" id="Compagnie" name="Compagnie" class="form-control" placeholder="Ex: Mahu Inc."></div>
                        <div class="form-group"><label for="Location">Location</label><input type="text" id="Location" name="Location" class="form-control" placeholder="Ex: Paris, France"></div>
                    </div>
                    <!-- Panneau d'édition "Apparence" -->
                    <div id="edit-pane-appearance" class="edit-pane">
                        <h3>Apparence</h3>
                        <p class="text-secondary" style="color: var(--text-secondary); margin-top:-10px; margin-bottom: 20px;">Personnalisez l'aspect et la convivialité de votre profil.</p>

                        <h4>Mise en page</h4>
                        <p class="text-secondary" style="color: var(--text-secondary); margin-top:-10px; margin-bottom: 10px;">Modifier l'affichage de votre profil.</p>
                        <!-- Options de mise en page (simplifiées) -->
                        <select name="Mise_En_Page" class="form-control">
                            <option value="default">Mise en page par défaut</option>
                            <option value="fullscreen_photo">Photo de profil en plein écran</option>
                            <option value="fullscreen_bg">Arrière-plan en plein écran</option>
                        </select>

                        <h4 style="margin-top: 25px;">Typographie</h4>
                        <p class="text-secondary" style="color: var(--text-secondary); margin-top:-10px; margin-bottom: 10px;">Modifier la police et les couleurs du texte de votre profil.</p>
                        <div class="form-grid">
                            <div class="form-group"><label for="Couleur_Theme">Couleur du Thème</label><input type="color" id="Couleur_Theme" name="Couleur_Theme" class="form-control" value="#007BFF" style="padding: 5px; height: 45px;"></div>
                        </div>

                        <h4 style="margin-top: 25px;">Images</h4>
                        <div class="form-group"><label for="profile-picture">Photo de profil / Logo</label><img id="image-preview" src="https://via.placeholder.com/100?text=Aperçu" alt="Aperçu" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; display: block; margin-bottom: 10px;"><input type="file" id="profile-picture" name="profilePicture" class="form-control" accept="image/*" onchange="previewImage(event)"></div>
                        <div class="form-group"><label for="cover-image">Image de couverture</label><input type="file" id="cover-image" name="coverImage" class="form-control" accept="image/*" onchange="previewImage(event)"></div>

                        <h4 style="margin-top: 25px;">Marque</h4>
                        <div class="toggle-switch"><span>Cacher la marque Mahu</span><input type="checkbox" id="toggle-branding"></div>

                        <div class="form-group" style="margin-top: 25px;"><label for="Langue">Langue</label><select id="Langue" name="Langue" class="form-control"><option value="fr">Français</option><option value="en">English</option></select></div>
                    </div>
                    <!-- Panneau d'édition "Liens" -->
                    <div id="edit-pane-links" class="edit-pane active"> <!-- Rendre les liens actifs par défaut après suppression des modules -->
                        <h3>Réseaux Sociaux & Liens</h3>
                        <div id="social-links-container"></div>
                        <button type="button" class="btn btn-secondary" onclick="addSocialLink()" style="width: auto; margin-top: 10px;">Ajouter un lien</button>
                    </div>
                    <hr style="border-color: var(--border-color); margin: 30px 0;">
                    <button type="submit" id="save-button" class="btn btn-primary">Sauvegarder les changements</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('profil-edit-modal')" style="margin-left: 10px;">Annuler</button>
                </form>
                <div class="phone-preview">
                    <div class="phone-screen">
                        <div id="phone-cover-preview" class="phone-cover" style="background-image: url('https://via.placeholder.com/800x300?text=Couverture');"></div>
                        <div class="phone-header">
                            <img id="phone-picture-preview" src="https://via.placeholder.com/150" alt="Aperçu profil">
                            <h3 id="phone-name-preview">Nom Prénom</h3>
                            <p id="phone-details-preview">Profession</p>
                        </div>
                        <div id="phone-social-links-preview" class="phone-social-links">
                            <!-- Les liens sociaux en aperçu seront injectés ici -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="config.js"></script>

    <script>
        /**
         * Fonction centralisée pour appeler l'API backend via POST.
         * @param {string} action - Le nom de l'action à exécuter côté serveur.
         * @param {Object} [data={}] - Un objet contenant les données à envoyer.
         * @returns {Promise<Object>} Une promesse qui se résout avec la réponse JSON de l'API.
         */
        function callApi(action, data = {}) {
            const formData = new FormData();
            const token = localStorage.getItem('authToken');
            if (!token && action !== 'loginUser' && action !== 'registerUser') {
                // Si pas de token et que l'action n'est pas une connexion/inscription, rediriger.
                window.location.href = 'Connexion.html';
            }
            formData.append('action', action);

            formData.append('payload', JSON.stringify(data)); // Envoyer toutes les données dans un seul payload
            formData.append('token', token); // Ajouter le token à chaque requête !

            return fetch(API_URL, { method: 'POST', body: formData }).then(res => res.json());
        }

        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const mainContent = document.querySelector('.main-content');
            const menuToggle = document.querySelector('.menu-toggle');
            
            const isCollapsed = sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('collapsed', isCollapsed);
            menuToggle.classList.toggle('collapsed', isCollapsed);

            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('visible');
            }

            // Sauvegarder l'état dans le localStorage
            localStorage.setItem('sidebarCollapsed', isCollapsed);
        }

        // Au chargement de la page, vérifier l'état sauvegardé
        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('sidebarCollapsed') === 'true' && window.innerWidth > 768) {
                toggleSidebar();
            }
        });

        function showPane(paneId, clickedElement) {
            // Si on clique sur un lien déjà actif, ne rien faire
            if (clickedElement.classList.contains('active')) {
                return;
            }
            document.querySelectorAll('.content-pane').forEach(pane => pane.classList.remove('active'));
            document.getElementById(paneId).classList.add('active');
            document.querySelectorAll('.sidebar nav a').forEach(link => link.classList.remove('active'));
            clickedElement.classList.add('active');
        }

        function addSocialLink(type = 'website', url = '') {
            const container = document.getElementById('social-links-container');
            const newLinkEntry = document.createElement('div');
            newLinkEntry.className = 'social-link-entry';

            const uniqueId = 'social_' + Date.now();

            const selectHTML = `
                <select class="form-control" name="social_type_${uniqueId}" onchange="updatePhoneSocialLinks()">
                    <option value="website" ${type === 'website' ? 'selected' : ''}>Site Web</option>
                    <option value="linkedin" ${type === 'linkedin' ? 'selected' : ''}>LinkedIn</option>
                    <option value="github" ${type === 'github' ? 'selected' : ''}>GitHub</option>
                    <option value="twitter" ${type === 'twitter' ? 'selected' : ''}>X (Twitter)</option>
                    <option value="instagram" ${type === 'instagram' ? 'selected' : ''}>Instagram</option>
                    <option value="facebook" ${type === 'facebook' ? 'selected' : ''}>Facebook</option>
                    <option value="tiktok" ${type === 'tiktok' ? 'selected' : ''}>TikTok</option>
                    <option value="youtube" ${type === 'youtube' ? 'selected' : ''}>YouTube</option>
                    <option value="whatsapp" ${type === 'whatsapp' ? 'selected' : ''}>WhatsApp</option>
                    <option value="telegram" ${type === 'telegram' ? 'selected' : ''}>Telegram</option>
                    <option value="snapchat" ${type === 'snapchat' ? 'selected' : ''}>Snapchat</option>
                    <option value="other" ${type === 'other' ? 'selected' : ''}>Lien personnalisé</option>
                </select>
            `;

            newLinkEntry.innerHTML = `
                ${selectHTML}
                <input type="url" class="form-control" name="social_url_${uniqueId}" placeholder="https://..." value="${url}" required oninput="updatePhoneSocialLinks()">
                <button type="button" class="btn btn-danger" onclick="this.parentElement.remove()">✕</button>
            `;
            container.appendChild(newLinkEntry);
        }

        function toggleModule(moduleName, isEnabled) {
            console.log(`Module ${moduleName} : ${isEnabled}`);
            reader.readAsDataURL(event.target.files[0]);
        }

        function handleSave(event) {
            event.preventDefault();
            const button = document.getElementById('save-button');
            button.textContent = 'Sauvegarde en cours...';
            button.disabled = true;

            const profileForm = document.getElementById('profile-form');

            const profileData = {
                // Panneau "À propos"
                Nom_Complet: profileForm.Nom_Complet.value,
                URL_Profil: profileForm.URL_Profil.value, // Ajout du nouveau champ
                Profession: profileForm.Profession.value,
                Compagnie: profileForm.Compagnie.value,
                Location: profileForm.Location.value,

                // Panneau "Apparence"
                Mise_En_Page: profileForm.Mise_En_Page.value,
                // Police: profileForm.Police.value, // Champ Police n'existe pas dans le HTML
                Couleur_Theme: profileForm.Couleur_Theme.value, // Nouveau champ
                Cacher_Marque: document.getElementById('toggle-branding').checked,
                Langue: profileForm.Langue.value,

                // Panneau "Liens"
                Liens_Sociaux_JSON: getSocialLinksData()
            };
            
            // Gestion des images
            const profilePicFile = document.getElementById('profile-picture').files[0];
            const coverFile = document.getElementById('cover-image').files[0];

            const uploadAndSave = (picFile, covFile) => {
                const uploads = [];
                if (picFile) {
                    uploads.push(uploadToImgBB(picFile).then(url => profileData.URL_Photo = url));
                }
                if (covFile) {
                    uploads.push(uploadToImgBB(covFile).then(url => profileData.URL_Couverture = url));
                }

                Promise.all(uploads)
                    .then(() => saveDataToSheet(profileData, button)) // Passer le bouton à la fonction de sauvegarde
                    .catch(error => {
                        console.error('Erreur d\'upload:', error);
                        alert('Une erreur est survenue lors de l\'envoi des images.');
                        button.textContent = 'Sauvegarder les changements';
                        button.disabled = false;
                    });
            };

            uploadAndSave(profilePicFile, coverFile); // Déclenche la sauvegarde après l'upload
        }

        function uploadToImgBB(file) {
            return new Promise((resolve, reject) => {
                const apiKey = '96ff1e4e9603661db4d410f53df99454'; // Clé API ImgBB directement dans le code
                const formData = new FormData();
                formData.append('image', file);

                fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        resolve(result.data.url);
                    } else {
                        reject(new Error('Erreur ImgBB: ' + result.error.message));
                    }
                })
                .catch(reject);
            });
        }

        function saveDataToSheet(data, button) {
            callApi('saveProfile', data) // Envoyer directement l'objet de données
                .then(response => {
                    alert(response.error || response.message || 'Profil sauvegardé !');
                    closeModal('profil-edit-modal');
                    fetchDashboardData(); // Recharger les données
                })
                .catch(err => {
                    alert('Erreur de sauvegarde: ' + (err.message || "Erreur inconnue"));
                }).finally(() => {
                    document.getElementById('save-button').textContent = 'Sauvegarder les changements';
                    document.getElementById('save-button').disabled = false;
                });
        }
    </script>

    <script>
        // --- Logique pour les Wallets ---
        function addToAppleWallet() {
            alert("L'intégration avec Apple Wallet nécessite un service serveur dédié. Cette fonctionnalité est en cours de développement.");
        }

        function addToGoogleWallet() {
            const button = document.getElementById('google-wallet-btn');
            button.textContent = 'Génération...';
            button.disabled = true;

            callApi('generateGoogleWalletPass')
                .then(response => {
                    if (response.success) {
                        window.open(`https://pay.google.com/gp/v/save/${response.jwt}`, '_blank');
                    } else {
                        alert("Erreur lors de la génération de la carte Google Wallet : " + response.error);
                    }
                    button.textContent = 'Add to Google Wallet';
                    button.disabled = false;
                })
                .catch(err => alert('Erreur de communication avec le serveur.'));
        } 
    </script>
    
    <!-- Intégration de Chart.js et appel à Apps Script -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            fetchDashboardData();
            fetchStatsData();
            feather.replace();
        });

        function fetchDashboardData() {
            callApi('getDashboardData')
                .then(populateDashboard)
                .catch(onDashboardError);
        }

        function fetchStatsData() {
            callApi('getDashboardStats')
                .then(drawChart)
                .catch(onChartError);
        }


        function onDashboardError(error) {
            console.error("Erreur de chargement du dashboard:", error.message);
            alert("Impossible de charger les données du tableau de bord.");
        }

        function populateDashboard(data) {
            if (data.error) {
                onDashboardError({ message: data.error });
                return;
            }

            // --- Remplir le panneau d'aperçu du profil ---
            const baseUrl = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);
            const fullUrl = `${baseUrl}ProfilePublic.html?user=${data.user.URL_Profil}`;

            // Aperçu
            document.getElementById('profile-picture-preview').src = data.profile.URL_Photo || 'https://via.placeholder.com/150';
            document.getElementById('profile-cover-preview').style.backgroundImage = `url('${data.profile.URL_Couverture || 'https://via.placeholder.com/800x300?text=Couverture'}')`;
            document.getElementById('profile-name-preview').textContent = data.profile.Nom_Complet || 'Nom non défini';
            const subtitleParts = [data.profile.Profession, data.profile.Compagnie, data.profile.Location].filter(Boolean);
            document.getElementById('profile-details-preview').textContent = subtitleParts.join(' | ') || 'Informations non disponibles';

            // Actions de partage
            // Utilisation de quickchart.io pour un QR code avec logo. On construit l'URL absolue du logo.
            const logoUrl = new URL('r/logo.png', window.location.href).href;
            document.getElementById('profile-qrcode').src = `https://quickchart.io/qr?text=${encodeURIComponent(fullUrl)}&logo=${logoUrl}&size=250&centerImage=true`;
            
            // Générer le lien de téléchargement en haute résolution
            const highResQrUrl = `https://quickchart.io/qr?text=${encodeURIComponent(fullUrl)}&logo=${logoUrl}&size=1024&format=png&centerImage=true`;
            document.getElementById('download-qrcode-btn').href = highResQrUrl;

            const shareLinkBtn = document.getElementById('share-link');
            shareLinkBtn.onclick = () => { navigator.clipboard.writeText(fullUrl); alert('Lien copié !'); };
            document.getElementById('share-email').href = `mailto:?subject=Découvrez mon profil Brunel&body=Voici mon profil numérique : ${fullUrl}`;
            document.getElementById('share-sms').href = `sms:?&body=Voici mon profil numérique : ${fullUrl}`;

            // Barre de progression
            let completeness = 0;
            if (data.profile.Nom_Complet) completeness += 20;
            if (data.profile.URL_Photo) completeness += 20;
            if (data.profile.URL_Couverture) completeness += 20;
            if (subtitleParts.length > 0) completeness += 20;
            if (JSON.parse(data.profile.Liens_Sociaux_JSON || '[]').length > 0) completeness += 20;
            document.getElementById('profile-completeness-percent').textContent = `${completeness}%`;
            document.getElementById('profile-completeness-bar').style.width = `${completeness}%`;

            // Remplir l'éditeur de profil
            // Panneau "À propos"
            document.getElementById('Nom_Complet').value = data.profile.Nom_Complet || '';
            document.getElementById('URL_Profil').value = data.user.URL_Profil || ''; // Remplir le champ URL
            document.getElementById('Profession').value = data.profile.Profession || '';
            document.getElementById('Compagnie').value = data.profile.Compagnie || '';
            document.getElementById('Location').value = data.profile.Location || '';
            // Panneau "Apparence"
            // Remplir les champs d'apparence avec les données sauvegardées (ou des valeurs par défaut)
            document.querySelector('select[name="Mise_En_Page"]').value = data.profile.Mise_En_Page || 'default';
            document.getElementById('Couleur_Theme').value = data.profile.Couleur_Theme || '#007BFF'; // Nouveau champ
            // document.getElementById('Couleur_Theme').value = data.profile.Couleur_Theme || '#007BFF'; // Remplacé par les nouveaux champs
            if (data.profile.URL_Photo) {
                document.getElementById('image-preview').src = data.profile.URL_Photo;
            }

            // Remplir l'aperçu du téléphone
            document.getElementById('phone-picture-preview').src = data.profile.URL_Photo || 'https://via.placeholder.com/150';
            document.getElementById('phone-cover-preview').style.backgroundImage = `url('${data.profile.URL_Couverture || 'https://via.placeholder.com/800x300?text=Couverture'}')`;
            document.getElementById('phone-name-preview').textContent = data.profile.Nom_Complet || 'Nom non défini';
            const phoneSubtitleParts = [data.profile.Profession, data.profile.Compagnie, data.profile.Location].filter(Boolean);
            document.getElementById('phone-details-preview').textContent = phoneSubtitleParts.join(' | ') || 'Informations non disponibles';
            document.querySelector('.phone-header img').style.borderColor = data.profile.Couleur_Theme || '#007BFF'; // Utilise la couleur du thème
            
            // Remplir les liens sociaux dans l'éditeur
            updatePhoneSocialLinks(); // Mettre à jour l'aperçu

            document.getElementById('social-links-container').innerHTML = ''; // Vider avant de remplir
            const socialLinks = JSON.parse(data.profile.Liens_Sociaux_JSON || '[]');
            socialLinks.forEach(link => {
                addSocialLink(link.type, link.url);
            });

            // Remplir la liste des cartes NFC
            const nfcList = document.getElementById('nfc-card-list');
            const nfcCards = JSON.parse(data.user.ID_Cartes_NFC || '[]');
            nfcList.innerHTML = '';
            if (nfcCards.length > 0) {
                nfcCards.forEach(cardId => {
                    nfcList.innerHTML += `<li>Carte NFC #${cardId}</li>`;
                });
            } else {
                nfcList.innerHTML = '<li>Aucune carte NFC liée.</li>';
            }

            // Remplir la table des prospects
            const prospectsBody = document.getElementById('prospects-table-body');
            prospectsBody.innerHTML = '';
            if (data.prospects.length > 0) {
                data.prospects.forEach(p => {
                    prospectsBody.innerHTML += `<tr><td>${p.nom || ''}</td><td>${p.contact || ''}</td><td>${new Date(p.date).toLocaleDateString()}</td><td>${p.note || ''}</td></tr>`;
                });
            } else {
                prospectsBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Aucun prospect pour le moment.</td></tr>';
            }

            // Mettre à jour les toggles des modules
            document.getElementById('toggle-cv').checked = data.profile.CV_Actif === 'OUI';
            document.getElementById('toggle-lead').checked = data.profile.Lead_Capture_Actif === 'OUI';


            // Remplir les paramètres
            document.getElementById('account-email').textContent = data.user.Email;
        }

        function getSocialLinksData() {
            const container = document.getElementById('social-links-container');
            const entries = container.querySelectorAll('.social-link-entry');
            const links = [];
            entries.forEach(entry => {
                const type = entry.querySelector('select').value;
                const url = entry.querySelector('input[type="url"]').value;
                if (url) {
                    links.push({ type, url });
                }
            });
            return JSON.stringify(links);
        }

        /**
         * Dessine le graphique une fois les données reçues de Google Sheets.
         * @param {object} stats - L'objet contenant {labels: [...], data: [...]}.
         */
        function drawChart(stats) {
            if (stats.error) {
                onChartError({ message: stats.error });
                return;
            }

            // Mettre à jour les chiffres dans les cartes de statistiques
            document.querySelector('.stat-item:nth-child(2) .number').textContent = stats.data[0] || 0; // NFC
            document.querySelector('.stat-item:nth-child(3) .number').textContent = stats.data[1] || 0; // QR Code
            document.querySelector('.stat-item:nth-child(4) .number').textContent = stats.data[2] || 0; // Lien
            const total = stats.data.reduce((a, b) => a + b, 0);
            document.querySelector('.stat-item:nth-child(1) .number').textContent = total;

            const ctx = document.getElementById('viewsChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: stats.labels,
                    datasets: [{
                        label: 'Vues par source',
                        data: stats.data,
                        backgroundColor: 'rgba(0, 123, 255, 0.6)',
                        borderColor: 'rgba(0, 123, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        function onChartError(error) {
            console.error("Erreur lors de la récupération des données du graphique :", error.message);
            document.getElementById('viewsChart').parentElement.innerHTML += '<p style="color: var(--red);">Impossible de charger le graphique.</p>';
        }

        // Fonctions pour la modale
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Fonction pour la navigation dans la modale d'édition
        function showEditPane(paneId, clickedElement) {
            document.querySelectorAll('.edit-pane').forEach(pane => pane.classList.remove('active'));
            document.getElementById(paneId).classList.add('active');
            document.querySelectorAll('.editor-nav-btn').forEach(btn => btn.classList.remove('active'));
            clickedElement.classList.add('active');
        }

        // Fonctions pour l'aperçu en direct
        document.getElementById('Nom_Complet').addEventListener('input', e => {
            document.getElementById('phone-name-preview').textContent = e.target.value || 'Nom Prénom';
        });
        document.getElementById('Profession').addEventListener('input', updatePhoneDetails);
        document.getElementById('Compagnie').addEventListener('input', updatePhoneDetails);
        document.getElementById('Location').addEventListener('input', updatePhoneDetails);

        // Ajout des écouteurs pour l'aperçu en direct des couleurs et polices
        document.getElementById('Couleur_Theme').addEventListener('input', e => {
            const themeColor = e.target.value;
            document.querySelector('.phone-header img').style.borderColor = themeColor;
            // Mettre à jour l'aperçu des boutons sociaux en direct
        });

        document.getElementById('profile-picture').addEventListener('change', e => {
            if (e.target.files && e.target.files[0]) {
                document.getElementById('phone-picture-preview').src = URL.createObjectURL(e.target.files[0]);
            }
        });
        document.getElementById('cover-image').addEventListener('change', e => {
            if (e.target.files && e.target.files[0]) {
                document.getElementById('phone-cover-preview').style.backgroundImage = `url('${URL.createObjectURL(e.target.files[0])}')`;
            }
        });
        function updatePhoneDetails() {
            const parts = [document.getElementById('Profession').value, document.getElementById('Compagnie').value, document.getElementById('Location').value].filter(Boolean);
            document.getElementById('phone-details-preview').textContent = parts.join(' | ') || 'Profession';
        }

        function updatePhoneSocialLinks() {
            const container = document.getElementById('social-links-container');
            const previewContainer = document.getElementById('phone-social-links-preview');
            previewContainer.innerHTML = '';

            // Récupérer les couleurs actuelles des boutons pour l'aperçu
            const themeColor = document.getElementById('Couleur_Theme').value;
            const buttonTextColor = 'white'; // Texte blanc sur la couleur du thème pour les boutons

            const entries = container.querySelectorAll('.social-link-entry');
            // Nouvelle table de correspondance pour vos logos SVG
            const iconMap = {
                twitter: 'r/logo/1.svg',   // X
                linkedin: 'r/logo/2.svg',  // ln
                tiktok: 'r/logo/3.svg',    // tiktok
                youtube: 'r/logo/4.svg',   // youtube
                instagram: 'r/logo/5.svg', // instagramme
                whatsapp: 'r/logo/6.svg',  // whtasapp
                telegram: 'r/logo/7.svg',  // telegrame
                facebook: 'r/logo/8.svg',  // faceboo
                snapchat: 'r/logo/9.svg'   // sanpp
            };

            entries.forEach(entry => {
                const type = entry.querySelector('select').value;
                const url = entry.querySelector('input[type="url"]').value;
                if (url) {
                    const iconSrc = iconMap[type]; // Récupère le chemin de votre SVG
                    const linkName = entry.querySelector('select').options[entry.querySelector('select').selectedIndex].text;
                    
                    // Utilise une balise <img> si un logo personnalisé existe
                    const iconHtml = iconSrc ? `<img src="${iconSrc}" class="social-icon">` : '';

                    previewContainer.innerHTML += `
                        <a href="#" class="phone-social-link" style="background-color: ${themeColor};">
                            ${iconHtml} <!-- L'icône sera blanche grâce au filtre invert(1) -->
                            <span style="color: ${buttonTextColor};">${linkName}</span>
                        </a>
                    `;
                }
            });
        }

        function logout() {
            callApi('logout')
                .then(() => localStorage.removeItem('authToken')) // Supprimer le token
                .finally(() => window.location.href = 'index.html');
        }
    </script>
</body>
</html> 