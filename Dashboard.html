<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Tableau de bord personnel pour la gestion de votre profil Mahu, de vos contacts et de vos statistiques.">
    <meta name="robots" content="noindex, nofollow"> <!-- Page privée, ne pas indexer -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tableau de Bord</title>
    <link rel="icon" href="r/logo.png" type="image/png">
    <style>
        /* Thème sombre par défaut */
        :root {
            --bg-main: #121212;
            --card-bg: #1E1E1E;
            --text-primary: #f8f9fa;
            --text-secondary: #adb5bd;
            --border-color: #444;
            --input-bg: rgba(0,0,0,0.2);
            --skeleton-bg: #3a3a3a;
            --skeleton-highlight: #4a4a4a;
            --phone-bg: #111;
            --social-icon-filter: invert(1);
            --sidebar-width-collapsed: 80px;
            --sidebar-width-expanded: 260px;
            --accent-color: #FFFFFF; /* Accent pour le mode sombre */
        }

        /* Thème clair */
        body.light-mode {
            --bg-main: #f4f7f6;
            --card-bg: #FFFFFF;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --input-bg: #f8f9fa;
            --skeleton-bg: #e0e0e0;
            --skeleton-highlight: #f0f0f0;
            --phone-bg: #ccc;
            --social-icon-filter: invert(0);
            --accent-color: #000000; /* Accent pour le mode clair */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            background: radial-gradient(circle at top, #2c2c2c, #000000); /* Fond gris-noir dégradé */
            background-attachment: fixed;
            color: var(--text-primary);
        }

        .dashboard-layout {
            display: flex;
        }

        /* Barre latérale */
        .sidebar {
            width: var(--sidebar-width-expanded);
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            background-color: var(--card-bg);
            backdrop-filter: blur(10px);
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between; /* Pour pousser la déconnexion en bas */
            z-index: 100;
        }

        .sidebar.collapsed {
            width: var(--sidebar-width-collapsed);
            align-items: center;
        }

        .sidebar h2 {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px 10px;
            height: 70px; /* Hauteur fixe pour l'alignement */
        }

        .sidebar h2 img {
            transition: transform 0.3s ease;
        }
        .sidebar h2:hover img {
            transform: scale(1.05);
        }

        .sidebar nav a {
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--text-secondary);
            text-decoration: none;
            padding: 15px 25px;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: background-color 0.3s, color 0.3s;
            font-weight: 500;
        }

        .sidebar nav a svg {
            width: 24px;
            height: 24px;
            stroke-width: 2;
        }

        .sidebar nav a:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .sidebar nav a.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: bold;
        }
        
        /* Cacher les éléments réservés aux admins pour les employés */
        body.role-employe .admin-only { display: none !important; }
        body.role-entreprise .employe-only { display: none !important; }

        .sidebar.collapsed nav a {
            justify-content: center; /* Centre l'icône quand replié */
        }

        .sidebar.collapsed nav a span {
            display: none; /* Cache le texte quand replié */
        }

        /* Contenu principal */
        .main-content {
            margin-left: var(--sidebar-width-expanded);
            flex-grow: 1;
            padding: 40px;
            box-sizing: border-box;
            transition: margin-left 0.3s ease;
        }

        /* Styles pour le bouton menu hamburger sur mobile */
        .menu-toggle {
            display: none; /* Caché par défaut sur grand écran */
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 101; /* Pour être au-dessus de la sidebar */
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .menu-toggle.moved {
            left: calc(var(--sidebar-width) + 20px);
        }

        /* Cartes de contenu */
        .card {
            background-color: var(--card-bg);
            backdrop-filter: blur(5px);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }

        .card h3 {
            margin-top: 0;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        /* Styles spécifiques au Dashboard */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; }
        .stat-item { text-align: center; }
        .stat-item .number { font-size: 2.5em; font-weight: bold; color: var(--text-primary); }
        .stat-item .label { color: var(--text-secondary); }
        .toggle-switch { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; border-bottom: 1px solid var(--border-color); text-align: left; }
        th { background-color: var(--input-bg); }
        .btn { padding: 10px 15px; border-radius: 5px; border: none; cursor: pointer; font-weight: 600; }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 10px; padding: 10px 15px; border-radius: 5px; border: none; cursor: pointer; font-weight: 600; }
        .btn-primary { background-color: var(--accent-color); color: var(--bg-main); }
        .btn-secondary { background-color: var(--text-secondary); color: var(--card-bg); }
        .btn-with-icon {
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-with-icon svg {
            width: 18px; height: 18px;
        }

        /* Squelette de chargement pour la table des contacts */
        .skeleton-row td div {
            height: 20px;
            background-color: var(--skeleton-bg);
            border-radius: 4px;
            animation: pulse 1.5s infinite ease-in-out;
        }
        @keyframes pulse {
            0% { background-color: var(--skeleton-bg); }
            50% { background-color: var(--skeleton-highlight); }
            100% { background-color: var(--skeleton-bg); }
        }

        .skeleton {
            display: inline-block;
            height: 1em;
            width: 70%;
            background-color: var(--skeleton-bg);
            border-radius: 4px;
            animation: pulse 1.5s infinite ease-in-out;
        }
        /* Styles pour les onglets de contenu */
        .content-pane {
            padding-top: 20px; /* Ajoute de l'espace au-dessus de chaque panneau pour le défilement */
            margin-bottom: 40px; /* Espace entre les panneaux */
        }
        
        /* Styles du formulaire de l'éditeur */
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 8px; color: var(--text-secondary); }
        .form-control {
            width: 100%; padding: 12px; background-color: var(--input-bg);
            border: 1px solid var(--border-color); border-radius: 5px;
            color: var(--text-primary); font-size: 1em; box-sizing: border-box; transition: border-color 0.3s;
        }
        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        textarea.form-control { min-height: 120px; resize: vertical; }

        .social-link-entry {
            display: grid;
            grid-template-columns: 1fr 2fr auto;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        .btn-danger { background-color: #555; color: white; padding: 8px 12px; font-size: 0.9em; }
        .btn-danger:hover { background-color: #dc3545; }

        /* Nouveaux styles pour le panneau Profil */
        .profile-preview-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
        }
        .profile-main-card {
            position: relative;
            padding: 0;
            overflow: hidden;
        }
        .profile-cover-image {
            width: 100%;
            height: 200px;
            background-color: #333;
            background-size: cover;
            background-position: center;
        }
        .profile-picture-container {
            position: relative;
            margin-top: -60px;
            padding: 0 25px;
        }
        .profile-picture-container img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid var(--card-bg);
            object-fit: cover;
        }
        .profile-info {
            padding: 15px 25px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }
        .profile-info-text { flex-grow: 1; }
        .profile-info-text h2 { margin: 0 0 10px 0; }
        .profile-info-text p { margin: 0; color: var(--text-secondary); }
        .profile-info-qr {
            text-align: center;
        }
        .profile-info-qr img {
            width: 100px; height: 100px; border-radius: 8px;
        }

        /* Styles pour l'overlay de modification d'image */
        .edit-overlay {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .profile-picture-container .edit-overlay {
            top: 5px;
            right: 0;
            left: 85px; /* Positionne le bouton à droite de l'image de profil */
            width: 32px; /* Assure que le conteneur ne s'étire pas */
        }
        .edit-overlay-btn {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 20px;
            line-height: 32px;
            text-align: center;
            cursor: pointer;
        }
        .edit-dropdown-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 40px;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            z-index: 10;
            overflow: hidden;
        }
        .edit-dropdown-menu a {
            display: block;
            padding: 10px 15px;
            color: var(--text-primary);
            text-decoration: none;
        }
        .edit-dropdown-menu a:hover { background-color: rgba(255,255,255,0.1); }

        /* Styles pour la grille de partage */
        .share-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .share-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px 5px;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 0.75em;
            text-align: center;
            height: 80px;
            font-family: inherit; /* Pour que le bouton hérite de la police */
        }
        .share-btn:hover {
            background-color: var(--accent-color);
            color: var(--bg-main);
            border-color: var(--accent-color);
            transform: translateY(-3px);
        }
        .share-btn svg {
            width: 24px;
            height: 24px;
            margin-bottom: 8px;
            stroke-width: 1.5;
        }

        /* Header flexible pour les cartes */
        .card-header-flex {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        .card-header-flex h3 {
            margin: 0;
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }

        .progress-bar-container {
            margin-bottom: 20px;
        }
        .progress-bar {
            width: 100%; background-color: #333; border-radius: 5px; overflow: hidden;
        }
        .progress-bar-inner {
            height: 10px; width: 0%; /* Défini par JS */
            background: var(--accent-color);
            transition: width 0.5s ease;
        }

        /* Nouveaux styles pour la fenêtre modale */
        .modal {
            display: none; /* Caché par défaut */
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: var(--card-bg);
            margin: 5% auto;
            padding: 30px;
            border: 1px solid var(--border-color);
            width: 80%;
            max-width: 1100px; /* Augmenté pour la nouvelle interface */
            border-radius: 12px;
            animation: slideIn 0.4s;
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .close-btn {
            color: var(--text-secondary); float: right; font-size: 28px; font-weight: bold; cursor: pointer;
        }
        
        /* Nouveaux styles pour l'éditeur de profil modal */
        .modal-editor-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        .editor-nav {
            display: flex;
            gap: 10px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }
        .editor-nav-btn {
            padding: 10px 15px;
            cursor: pointer;
            border: none;
            background: none;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
        }
        .editor-nav-btn.active {
            color: var(--text-primary);
            border-bottom-color: var(--accent-color);
        }
        .edit-pane { display: none; }
        .edit-pane.active { display: block; }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        /* Styles pour le simulateur de téléphone */
        .phone-preview {
            background-color: var(--phone-bg);
            border-radius: 40px;
            padding: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            height: fit-content;
        }
        .phone-screen {
            background-color: var(--card-bg);
            height: 600px;
            border-radius: 25px;
            display: flex;
            position: relative; /* Ajout pour le positionnement du bouton de fermeture */
        }
        .phone-screen-inner {
            flex-grow: 1;
            flex-direction: column;
            overflow: hidden; /* Empêche le défilement global */
        }
        .phone-scrollable-content {
            flex-grow: 1;
            overflow-y: auto;
        }

        .phone-header { text-align: center; padding: 0 20px 20px; }
        .phone-header img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--accent-color);
            object-fit: cover;
            margin-top: -40px; /* Fait remonter l'image sur la couverture */
            position: relative; /* Pour s'assurer qu'elle est au-dessus */
        }
        .phone-header h3 { margin: 10px 0 5px 0; font-size: 1.2em; }
        .phone-header p { margin: 0; font-size: 0.9em; color: var(--text-secondary); }
        
        /* Scrollbar pour le téléphone */
        .phone-scrollable-content::-webkit-scrollbar { width: 4px; }
        .phone-scrollable-content::-webkit-scrollbar-track { background: transparent; }
        .phone-scrollable-content::-webkit-scrollbar-thumb { background: #555; border-radius: 2px; }
        .phone-scrollable-content::-webkit-scrollbar-thumb:hover { background: #777; }

        .phone-cover { height: 120px; background-size: cover; background-position: center; }

        .phone-qr-section {
            padding: 20px;
            text-align: center;
            background-color: rgba(0,0,0,0.15);
            flex-shrink: 0; /* Empêche cette section de se réduire */
        }
        .phone-qr-section img {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .phone-qr-section p {
            margin: 0;
            font-weight: 500;
            color: var(--text-primary);
        }

        .phone-social-links {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 15px;
        }
        .phone-social-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: var(--text-secondary);
        }
        .phone-social-link img.social-icon { /* Cible pour les nouvelles icônes SVG */
            width: 20px;
            height: 20px;
            filter: var(--social-icon-filter); /* Assure que les icônes sont blanches par défaut */
            margin-bottom: 5px;
        }
        .phone-social-link span {
            font-size: 0.75em;
            text-align: center;
        }

        /* Styles pour la preview téléphone (copiés de ProfilePublic) */
        .phone-contact-info { margin-top: 20px; padding: 0 20px; }
        .copyable-field-preview {
            display: flex; align-items: center; justify-content: space-between;
            background-color: rgba(0,0,0,0.05); border-radius: 8px;
            padding: 10px 15px; margin-bottom: 10px; font-size: 0.9em;
            color: var(--text-primary); border: 1px solid rgba(0,0,0,0.1);
        }
        .copy-icon-preview { cursor: pointer; opacity: 0.7; }

        .action-buttons-preview {
            margin: 20px 0; display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 0 20px;
        }
        .action-btn-preview {
            background-color: transparent; border: 1px solid var(--border-color);
            border-radius: 8px; padding: 10px 5px; text-align: center;
            font-size: 0.8em; color: var(--text-primary);
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px;
            cursor: default;
        }
        .action-btn-preview svg {
            width: 20px; height: 20px;
        }
        /* Mode sombre pour la preview */
        .phone-preview .copyable-field-preview {
            background-color: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.1);
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(calc(-1 * var(--sidebar-width-expanded)));
                transition: transform 0.3s ease;
            }
            .menu-toggle {
                display: flex; /* Afficher le bouton sur mobile */
            }
            .sidebar.visible {
                transform: translateX(0);
            }
            body {
                overflow-x: hidden;
            }
            .main-content {
                margin-left: 0 !important;
                padding: 15px;
                width: 100%;
                overflow-x: hidden;
            }
            .main-content.collapsed { margin-left: 0 !important; }

            .card {
                padding: 15px;
                margin-bottom: 15px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            .stat-item .number { font-size: 1.8em; }

            .profile-preview-grid {
                grid-template-columns: 1fr;
            }
            .modal-editor-layout {
                display: flex;
                flex-direction: column-reverse; /* Met le téléphone en haut sur mobile */
            }
            .phone-preview {
                grid-template-columns: 1fr;
                max-width: 100%; /* Empêche le débordement */
                margin: 0 auto;
            }
            .modal-content {
                width: 95%;
                margin: 2% auto; /* Moins de marge en haut sur mobile */
                padding: 15px;
                max-height: 95vh; /* Empêche le débordement vertical */
                overflow-y: auto;
            }
            .profile-picture-container .edit-overlay {
                left: auto; /* Annule le positionnement à gauche */
                right: calc(50% - 60px); /* Centre le bouton par rapport à l'image */
                transform: translateX(100%);
            }
            .phone-screen {
                height: 500px; /* Réduit la hauteur sur les petits écrans */
            }
            .modal-editor-layout > form {
                max-height: 50vh; overflow-y: auto; padding-right: 10px; 
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .share-actions {
                grid-template-columns: 1fr;
            }
            h1 { font-size: 1.5em; }
            h2 { font-size: 1.3em; }
            h3 { font-size: 1.1em; }
        }
    </style>
</head>
<body>
    <div class="dashboard-layout">
        <div class="menu-toggle" onclick="toggleSidebar()">☰</div>
        <aside class="sidebar">
            <h2><img src="r/logo.png" alt="Logo Brunel" style="height: 70px;"></h2>
            <nav>
                <a href="#" class="active" onclick="showPane(event, 'profil-content', this)" title="Profil">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                    <span>Profil</span>
                </a>
                <a href="#" onclick="showPane(event, 'contact-content', this)" title="Contacts">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                    <span>Contacts</span>
                </a>
                <a href="#" onclick="showPane(event, 'team-content', this)" title="Mon Équipe" class="admin-only" id="nav-team">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                    <span>Mon Équipe</span>
                </a>
                <a href="#" onclick="showPane(event, 'statistique-content', this)" title="Statistiques">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
                    <span>Statistiques</span>
                </a>
                <a href="#" onclick="showPane(event, 'documents-content', this)" title="Mes Documents">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                    <span>Mes Documents</span>
                </a>
                <a href="#" onclick="showPane(event, 'parametre-content', this)" title="Paramètres">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="21" x2="4" y2="14"></line><line x1="4" y1="10" x2="4" y2="3"></line><line x1="12" y1="21" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="3"></line><line x1="20" y1="21" x2="20" y2="16"></line><line x1="20" y1="12" x2="20" y2="3"></line><line x1="1" y1="14" x2="7" y2="14"></line><line x1="9" y1="8" x2="15" y2="8"></line><line x1="17" y1="16" x2="23" y2="16"></line></svg>
                    <span>Paramètres</span>
                </a>
                <a href="#" onclick="showPane(event, 'blog-content', this)" title="Blog">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                    <span>Blog</span>
                </a>
            </nav>
            <nav> <!-- Conteneur séparé pour le bouton de déconnexion -->
                <a href="#" onclick="logout()" title="Déconnexion">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                    <span>Déconnexion</span>
                </a>
            </nav>
        </aside>

        <main class="main-content">
            <!-- Panneau Profil (Aperçu) -->
            <div id="profil-content" class="content-pane">
                <h1>Profil</h1>
                <div class="progress-bar-container">
                    <p>Complétion du profil : <span id="profile-completeness-percent">...</span></p>
                    <div class="progress-bar"><div id="profile-completeness-bar" class="progress-bar-inner"></div></div>
                </div>
                <div class="profile-preview-grid">
                    <!-- Colonne principale -->
                    <div class="profile-main-column">
                        <div class="card profile-main-card">
                            <div id="profile-cover-preview" class="profile-cover-image" style="background-image: url('https://placehold.co/800x300/333/ccc?text=Couverture');">
                                <div class="edit-overlay">
                                    <button class="edit-overlay-btn" onclick="toggleEditMenu(event, 'cover-edit-menu')">+</button>
                                    <div id="cover-edit-menu" class="edit-dropdown-menu admin-only"> <!-- Seul l'admin change la cover -->
                                        <a href="#" onclick="triggerFileInput('cover-image-input')">Modifier</a>
                                        <a href="#" onclick="deleteImage(event, 'cover')">Supprimer</a>
                                    </div>
                                </div>
                            </div>
                            <div class="profile-picture-container">
                                <img id="profile-picture-preview" src="https://placehold.co/150x150/333/ccc?text=Profil" alt="Photo de profil">
                                <div class="edit-overlay">
                                    <button class="edit-overlay-btn" onclick="toggleEditMenu(event, 'picture-edit-menu')">+</button>
                                    <div id="picture-edit-menu" class="edit-dropdown-menu">
                                        <a href="#" onclick="triggerFileInput('profile-picture-input')">Modifier</a>
                                        <a href="#" onclick="deleteImage(event, 'picture')">Supprimer</a>
                                    </div>
                                </div>
                            </div>
                            <div class="profile-info">
                                <div class="profile-info-text">
                                    <h2 id="profile-name-preview">Nom Prénom</h2>
                                    <p id="profile-details-preview">Profession | Entreprise | Lieu</p>
                                    <button class="btn btn-primary btn-with-icon" style="margin-top: 20px;" onclick="openModal('profil-edit-modal');">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                                        <span>Modifier le Profil</span>
                                    </button>
                                    <button id="view-profile-btn" class="btn btn-secondary btn-with-icon" style="margin-top: 20px; margin-left: 10px;" onclick="">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                                        <span>Voir le profil</span>
                                    </button>
                                </div>
                                <div class="profile-info-qr">
                                    <img id="profile-qrcode" src="https://placehold.co/150x150/333/ccc?text=QR" alt="QR Code">
                                    <a id="download-qrcode-btn" href="#" download="qrcode-mahu.png" style="font-size: 0.8em; color: var(--text-secondary); display: block; margin-top: 5px;">Télécharger</a>
                                </div>
                            </div>
                    </div>
                    <!-- Inputs cachés pour le changement d'image direct -->
                    <input type="file" id="profile-picture-input" accept="image/*" style="display:none;" onchange="handleDirectImageChange(event, 'picture')">
                    <input type="file" id="cover-image-input" accept="image/*" style="display:none;" onchange="handleDirectImageChange(event, 'cover')">

                    <!-- Colonne latérale -->
                    <div class="profile-sidebar-column">
                        <div class="card">
                            <h3>Partager le Profil</h3>
                            <div class="share-grid">
                                <button id="share-copy-btn" class="share-btn" title="Copier le lien">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                                    <span>Copier</span>
                                </button>
                                <a id="share-email" href="#" class="share-btn" title="Email">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                    <span>Email</span>
                                </a>
                                <a id="share-facebook" href="#" class="share-btn" target="_blank" title="Facebook">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
                                    <span>Facebook</span>
                                </a>
                                <a id="share-sms" href="#" class="share-btn" title="SMS">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                    <span>SMS</span>
                                </a>
                                <a id="share-whatsapp" href="#" class="share-btn" target="_blank" title="WhatsApp">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
                                    <span>WhatsApp</span>
                                </a>
                                <a id="share-instagram" href="#" class="share-btn" title="Instagram">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
                                    <span>Instagram</span>
                                </a>
                                <a id="share-tiktok" href="#" class="share-btn" title="TikTok">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M9 12a4 4 0 1 0 4 4V4a5 5 0 0 0 5 5v4a9 9 0 0 1-9-9"></path></svg>
                                    <span>TikTok</span>
                                </a>
                                <a id="share-linkedin" href="#" class="share-btn" target="_blank" title="LinkedIn">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
                                    <span>LinkedIn</span>
                                </a>
                                <a id="share-qr-dl" href="#" download="qrcode-mahu.png" class="share-btn" title="QR Code">
                                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                                     <span>QR Code</span>
                                </a>
                                <button id="share-plus-btn" class="share-btn" title="Plus d'options">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
                                    <span>Plus</span>
                                </button>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Panneau Contacts -->
            <div id="contact-content" class="content-pane">
                <h1>Contacts</h1>
                <div class="card">
                    <div class="card-header-flex">
                        <h3>Mes Prospects</h3>
                        <button class="btn btn-secondary btn-with-icon" onclick="exportLeads()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                            <span>Exporter en CSV</span>
                        </button>
                    </div>
                    <div style="overflow-x:auto;">
                        <table>
                        <thead>
                            <tr>
                                <th>Nom du Prospect</th>
                                <th>Contact (Email/Tél)</th>
                                <th>Date</th>
                                <th>Note</th>
                            </tr>
                        </thead>
                        <tbody id="prospects-table-body">
                            <tr class="skeleton-row"><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
                            <tr class="skeleton-row"><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
                            <tr class="skeleton-row"><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
                            <tr class="skeleton-row"><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
                            <tr class="skeleton-row"><td><div></div></td><td><div></div></td><td><div></div></td><td><div></div></td></tr>
                        </tbody>
                    </table>
                    </div>
                </div>
            </div>

            <!-- Panneau Équipe (Entreprise uniquement) -->
            <div id="team-content" class="content-pane admin-only">
                <h1>Mon Entreprise & Équipe</h1>
                
                <div class="card">
                    <div class="card-header-flex">
                        <h3>Informations de l'Entreprise</h3>
                        <button class="btn btn-secondary btn-with-icon" onclick="openModal('enterprise-edit-modal')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                            <span>Modifier</span>
                        </button>
                    </div>
                    <p><strong>Nom :</strong> <span id="display-enterprise-name">Chargement...</span></p>
                    <p><strong>Téléphone :</strong> <span id="display-enterprise-phone">...</span></p>
                    <p><strong>Adresse :</strong> <span id="display-enterprise-address">...</span></p>
                </div>

                <div class="card">
                    <div class="card-header-flex">
                        <h3>Membres de l'équipe</h3>
                        <div>
                            <button class="btn btn-secondary btn-with-icon" onclick="copyInviteLink()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"></path></svg>
                                <span>Lien d'invitation</span>
                            </button>
                            <button class="btn btn-primary btn-with-icon" onclick="openModal('add-employee-modal')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                <span>Ajouter un membre</span>
                            </button>
                        </div>
                    </div>
                    <div style="overflow-x:auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Email</th>
                                    <th>Prospects capturés</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="team-table-body">
                                <!-- Rempli par JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Panneau Statistiques -->
            <div id="statistique-content" class="content-pane">
                <h1>Statistiques</h1>
                <div class="card">
                    <h3>Aperçu Général</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div id="stats-total-views" class="number"><span class="skeleton" style="width: 60px; height: 40px;"></span></div>
                            <div class="label">Vues Totales</div>
                        </div>
                        <div class="stat-item">
                            <div id="stats-total-prospects" class="number"><span class="skeleton" style="width: 60px; height: 40px;"></span></div>
                            <div class="label">Prospects Capturés</div>
                        </div>
                        <div class="stat-item">
                            <div id="stats-nfc-views" class="number"><span class="skeleton" style="width: 60px; height: 40px;"></span></div>
                            <div class="label">Vues via NFC</div>
                        </div>
                        <div class="stat-item">
                            <div id="stats-qr-views" class="number"><span class="skeleton" style="width: 60px; height: 40px;"></span></div>
                            <div class="label">Vues via QR Code</div>
                        </div>
                        <div class="stat-item">
                            <div id="stats-link-views" class="number"><span class="skeleton" style="width: 60px; height: 40px;"></span></div>
                            <div class="label">Vues via Lien</div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h3>Vues par source (Graphique)</h3>
                    <canvas id="viewsChart" style="margin-top: 20px;"></canvas>
                </div>
            </div>

            <!-- Panneau Blog -->
            <div id="blog-content" class="content-pane">
                <h1>Gestion du Blog</h1>
                <div class="card">
                    <div class="card-header-flex">
                        <h3>Mes Articles</h3>
                        <button class="btn btn-primary btn-with-icon" onclick="alert('Fonctionnalité à venir : Créer un article')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                            <span>Nouvel Article</span>
                        </button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Titre</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="blog-table-body">
                            <tr><td colspan="3" style="text-align:center; color:var(--text-secondary);">Aucun article pour le moment.</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Panneau Documents (Mode Disque) -->
            <div id="documents-content" class="content-pane">
                <h1>Mes Documents (Coffre-fort)</h1>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">Stockez vos documents importants en toute sécurité. Ces documents sont privés.</p>
                
                <div class="card">
                    <h3>Mes Cartes (Identité / Visite)</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Recto</label>
                            <div class="image-upload-box" id="card-front-preview" onclick="triggerFileInput('card-front-input')">
                                <span>+ Ajouter Recto</span>
                            </div>
                            <input type="file" id="card-front-input" hidden accept="image/*" onchange="handleDocUpload(event, 'card_front')">
                        </div>
                        <div class="form-group">
                            <label>Verso</label>
                            <div class="image-upload-box" id="card-back-preview" onclick="triggerFileInput('card-back-input')">
                                <span>+ Ajouter Verso</span>
                            </div>
                            <input type="file" id="card-back-input" hidden accept="image/*" onchange="handleDocUpload(event, 'card_back')">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Papiers Importants</h3>
                    <ul id="important-docs-list" class="doc-list">
                        <!-- Liste générée par JS -->
                    </ul>
                    <button class="btn btn-secondary btn-with-icon" onclick="triggerFileInput('doc-upload-input')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                        <span>Ajouter un document</span>
                    </button>
                    <input type="file" id="doc-upload-input" hidden accept="image/*,application/pdf" onchange="handleDocUpload(event, 'document')">
                </div>
            </div>

            <!-- Panneau Paramètres -->
            <div id="parametre-content" class="content-pane">
                <h1>Paramètres</h1>
                <div class="card">
                    <h3>Mon Compte</h3>
                    <p>Email du compte : <strong id="account-email">...</strong></p>
                    <button class="btn btn-secondary btn-with-icon" style="margin-top: 15px;" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                        <span>Changer le mot de passe (à venir)</span>
                    </button>
                </div>
                <div class="card">
                    <h3>Apparence</h3>
                    <button id="theme-toggle-btn" class="btn btn-secondary btn-with-icon" onclick="toggleTheme()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                        <span>Passer au mode clair</span>
                    </button>
                </div>
                <div class="card">
                    <h3>Gestion des Modules</h3>
                    <div class="toggle-switch">
                        <span>Capture de prospects</span>
                        <input type="checkbox" id="toggle-lead" onchange="toggleModule('Lead_Capture_Actif', this.checked)">
                    </div>
                </div>
               <div class="card">
                   <h3>Demande de Carte</h3>
                   <p><strong>Statut de la dernière commande :</strong> <span id="order-status">Aucune commande récente.</span></p>
                   <button class="btn btn-primary btn-with-icon" onclick="window.location.href='Boutique.html'" style="margin-top: 15px;">
                       <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                       <span>Commander une nouvelle carte</span>
                   </button>
               </div>
            </div>
            
        </main>
    </div>

    <!-- Fenêtre Modale pour l'édition du profil -->
    <div id="profil-edit-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('profil-edit-modal')">&times;</span>
            <h1>Modifier le Profil</h1>
            <div class="editor-nav">
                <button class="editor-nav-btn active" onclick="showEditPane('edit-pane-about', this)">Informations</button>
                <button class="editor-nav-btn" onclick="showEditPane('edit-pane-services', this)">Services (Entreprise)</button>
                <button class="editor-nav-btn" onclick="showEditPane('edit-pane-appearance', this)">Apparence & Liens</button>
                <!-- L'onglet "Liens" a été fusionné avec "À propos" -->
            </div>
            <div class="modal-editor-layout">
                <form id="profile-form" onsubmit="handleSave(event)">
                    <!-- Panneau d'édition "À propos" -->
                    <div id="edit-pane-about" class="edit-pane active">
                        <h3>Contenu Principal</h3>
                        <div class="form-group"><label for="Nom_Complet">Nom complet</label><input type="text" id="Nom_Complet" name="Nom_Complet" class="form-control" placeholder="Ex: Jean Dupont"></div>
                        <div class="form-group"><label for="URL_Profil">URL du profil personnalisée</label><input type="text" id="URL_Profil" name="URL_Profil" class="form-control" placeholder="Ex: jean-dupont (lettres, chiffres et tirets uniquement)"></div>
                        <div class="form-group"><label for="Email">Email Public</label><input type="email" id="Email" name="Email" class="form-control" placeholder="contact@exemple.com"></div>
                        <div class="form-group"><label for="Telephone">Téléphone</label><input type="tel" id="Telephone" name="Telephone" class="form-control" placeholder="+33 6 12 34 56 78"></div>
                        <div class="form-group"><label for="Profession">Profession</label><input type="text" id="Profession" name="Profession" class="form-control" placeholder="Ex: Commercial"></div>
                        <!-- Compagnie et Location sont gérés par l'entreprise pour les employés -->
                        <div class="form-group admin-only"><label for="Compagnie">Compagnie</label><input type="text" id="Compagnie" name="Compagnie" class="form-control" placeholder="Ex: Mahu Inc."></div>
                        <div class="form-group admin-only"><label for="Location">Location</label><input type="text" id="Location" name="Location" class="form-control" placeholder="Ex: Paris, France"></div>
                        
                    </div>
                    <!-- Panneau d'édition "Services" -->
                    <div id="edit-pane-services" class="edit-pane">
                        <h3>Nos Services</h3>
                        <div id="services-container"></div>
                        <button type="button" class="btn btn-secondary" onclick="addServiceField()" style="width: auto; margin-top: 10px;">Ajouter un service</button>
                    </div>
                    <!-- Panneau d'édition "Apparence" -->
                    <div id="edit-pane-appearance" class="edit-pane">
                        <h3>Réseaux Sociaux & Liens (Entreprise)</h3>
                        <div id="social-links-container"></div>
                        <button type="button" class="btn btn-secondary" onclick="addSocialLink()" style="width: auto; margin-top: 10px; margin-bottom: 30px;">Ajouter un lien</button>

                        <h3>Apparence</h3>
                        <p class="text-secondary" style="color: var(--text-secondary); margin-top:-10px; margin-bottom: 20px;">Personnalisez l'aspect et la convivialité de votre profil.</p>

                        <h4>Mise en page</h4>
                        <p class="text-secondary" style="color: var(--text-secondary); margin-top:-10px; margin-bottom: 10px;">Modifier l'affichage de votre profil.</p>
                        <!-- Options de mise en page (simplifiées) -->
                        <select name="Mise_En_Page" class="form-control">
                            <option value="default">Mise en page par défaut</option>
                            <option value="fullscreen_photo">Photo de profil en plein écran</option>
                            <option value="fullscreen_bg">Arrière-plan en plein écran</option>
                        </select>

                        <h4 style="margin-top: 25px;">Typographie</h4>
                        <p class="text-secondary" style="color: var(--text-secondary); margin-top:-10px; margin-bottom: 10px;">Modifier la police et les couleurs du texte de votre profil.</p>
                        <div class="form-grid">
                            <div class="form-group"><label for="Couleur_Theme">Couleur du Thème</label><input type="color" id="Couleur_Theme" name="Couleur_Theme" class="form-control" value="#007BFF" style="padding: 5px; height: 45px;"></div>
                        </div>

                        <h4 style="margin-top: 25px;">Marque</h4>
                        <div class="toggle-switch"><span>Cacher la marque Mahu</span><input type="checkbox" id="toggle-branding"></div>

                        <div class="form-group" style="margin-top: 25px;"><label for="Langue">Langue</label><select id="Langue" name="Langue" class="form-control"><option value="fr">Français</option><option value="en">English</option></select></div>
                    </div>
                    <hr style="border-color: var(--border-color); margin: 30px 0;">
                    <button type="submit" id="save-button" class="btn btn-primary">Sauvegarder les changements</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('profil-edit-modal')" style="margin-left: 10px;">Annuler</button>
                </form>
                <div class="phone-preview">
                    <div class="phone-screen">
                        <!-- Structure mise à jour pour correspondre exactement au profil public -->
                        <div class="phone-screen-inner public-profile-style" style="background: linear-gradient(120deg, var(--accent-color), #dc3545); padding: 20px; overflow-y: auto; display: flex; flex-direction: column; align-items: center;">
                            
                            <div class="profile-card-preview" style="background-color: rgba(30, 30, 30, 0.85); backdrop-filter: blur(10px); border-radius: 15px; width: 100%; text-align: center; position: relative; padding: 40px 20px 20px 20px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3); overflow: hidden;">
                                
                                <div id="phone-cover-preview" style="width: 100%; height: 150px; background-size: cover; background-position: center; position: absolute; top: 0; left: 0; background-image: url('https://placehold.co/800x300/333/ccc?text=Couverture');"></div>
                                
                                <div class="profile-header-preview" style="position: relative; margin-top: 90px;">
                                    <img id="phone-picture-preview" src="https://placehold.co/150x150/333/ccc?text=Profil" style="width: 120px; height: 120px; border-radius: 50%; border: 4px solid var(--accent-color); object-fit: cover; margin-bottom: 15px;">
                                    <h1 id="phone-name-preview" style="margin: 10px 0 5px; font-size: 1.8em; color: #f8f9fa;">Nom Prénom</h1>
                                    <p id="phone-details-preview" style="margin: 0 0 20px; font-size: 1.1em; color: #adb5bd;">Profession</p>
                                </div>

                                <div id="phone-contact-info-preview">
                                    <div class="copyable-field-preview" id="phone-number-container" style="display:flex; align-items: center; justify-content: space-between; background-color: rgba(0,0,0,0.2); border-radius: 8px; padding: 10px 15px; margin-bottom: 15px; color: #f8f9fa; border: none;">
                                        <span id="phone-number-preview"></span>
                                        <div class="copy-icon-preview">📋</div>
                                    </div>
                                    <div class="copyable-field-preview" id="email-address-container" style="display:flex; align-items: center; justify-content: space-between; background-color: rgba(0,0,0,0.2); border-radius: 8px; padding: 10px 15px; margin-bottom: 15px; color: #f8f9fa; border: none;">
                                        <span id="email-address-preview"></span>
                                        <div class="copy-icon-preview">📋</div>
                                    </div>
                                </div>

                                <div class="action-buttons-preview" style="margin: 30px 0; display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 0;">
                                    <div class="action-btn-preview" style="background-color: #f8f9fa; color: var(--accent-color); border-radius: 8px; padding: 15px 5px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px; font-size: 0.8em; font-weight: 500; border: none;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="23" y1="11" x2="17" y2="11"></line></svg>
                                        <span>Enregistrer</span>
                                    </div>
                                    <div class="action-btn-preview" style="background-color: transparent; color: #f8f9fa; border-radius: 8px; padding: 15px 5px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px; font-size: 0.8em; font-weight: 500; border: none;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                                        <span>Appeler</span>
                                    </div>
                                    <div class="action-btn-preview" style="background-color: transparent; color: #f8f9fa; border-radius: 8px; padding: 15px 5px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px; font-size: 0.8em; font-weight: 500; border: none;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                                        <span>Email</span>
                                    </div>
                                    <div class="action-btn-preview" style="background-color: transparent; color: #f8f9fa; border-radius: 8px; padding: 15px 5px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px; font-size: 0.8em; font-weight: 500; border: 1px solid rgba(255,255,255,0.5);">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                        <span>Télécharger</span>
                                    </div>
                                </div>

                                <div id="phone-social-links-preview" class="phone-social-links" style="display: grid; grid-template-columns: 1fr; gap: 10px; margin-top: 25px; text-align: left; padding: 0;">
                                    <!-- Les liens seront injectés ici -->
                                </div>

                                <!-- QR Code intégré dans la carte comme demandé -->
                                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                                    <img id="phone-qrcode-preview" src="https://placehold.co/150x150/333/ccc?text=QR" alt="Aperçu QR Code" style="width: 100px; height: 100px; border-radius: 8px;">
                                    <p style="margin: 5px 0 0; font-size: 0.8em; color: #adb5bd;">Mon QR Code</p>
                                </div>

                                <div style="margin-top: 30px; text-align: center;">
                                    <img src="r/logo.png" alt="Mahu" style="height: 20px; filter: invert(1) opacity(0.7);">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modale Édition Entreprise -->
    <div id="enterprise-edit-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close-btn" onclick="closeModal('enterprise-edit-modal')">&times;</span>
            <h2>Modifier les informations de l'entreprise</h2>
            <form onsubmit="handleEnterpriseSave(event)">
                <div class="form-group"><label>Nom de l'entreprise</label><input type="text" id="edit-enterprise-name" class="form-control" required></div>
                <div class="form-group"><label>Téléphone</label><input type="tel" id="edit-enterprise-phone" class="form-control"></div>
                <div class="form-group"><label>Adresse</label><input type="text" id="edit-enterprise-address" class="form-control"></div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Sauvegarder</button>
            </form>
        </div>
    </div>

    <!-- Modale Ajout Employé -->
    <div id="add-employee-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close-btn" onclick="closeModal('add-employee-modal')">&times;</span>
            <h2>Ajouter un membre</h2>
            <form onsubmit="handleCreateEmployee(event)">
                <div class="form-group"><label>Nom complet</label><input type="text" id="new-emp-name" class="form-control" required></div>
                <div class="form-group"><label>Email professionnel</label><input type="email" id="new-emp-email" class="form-control" required></div>
                <div class="form-group"><label>Mot de passe provisoire</label><input type="text" id="new-emp-password" class="form-control" required value="Mahu1234"></div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Créer le compte</button>
            </form>
            <div style="text-align: center; margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 20px;">
                <p style="color: var(--text-secondary);">Ou partagez ce lien pour qu'ils s'inscrivent eux-mêmes :</p>
                <button type="button" class="btn btn-secondary" onclick="copyInviteLink()">Copier le lien d'invitation</button>
            </div>
        </div>
    </div>

    <!-- Fenêtre Modale pour l'ajout/édition de produit -->
    <div id="product-modal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <span class="close-btn" onclick="closeModal('product-modal')">&times;</span>
            <h1 id="product-modal-title">Ajouter un produit</h1>
            <form id="product-form" onsubmit="handleProductSave(event)">
                <input type="hidden" id="product-id" name="product-id">
                <div class="form-group">
                    <label for="product-name">Nom du produit</label>
                    <input type="text" id="product-name" name="product-name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="product-price">Prix (en €)</label>
                    <input type="number" id="product-price" name="product-price" class="form-control" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="product-description">Description</label>
                    <textarea id="product-description" name="product-description" class="form-control"></textarea>
                </div>
                <div class="form-group">
                    <label>Images (jusqu'à 5)</label>
                    <p style="font-size: 0.8em; color: var(--text-secondary); margin-top: -8px;">La première image sera l'image principale.</p>
                    <div id="product-image-inputs">
                        <input type="file" name="product-image-1" class="form-control" accept="image/*" onchange="previewProductImage(this, 1)">
                        <!-- D'autres inputs seront ajoutés par JS si besoin -->
                    </div>
                    <div id="product-image-previews" style="display: flex; gap: 10px; margin-top: 10px;">
                        <!-- Les aperçus d'images apparaîtront ici -->
                    </div>
                </div>
                <hr style="border-color: var(--border-color); margin: 30px 0;">
                <button type="submit" id="product-save-button" class="btn btn-primary">Sauvegarder le produit</button>
                <button type="button" class="btn btn-danger" id="product-delete-button" onclick="handleProductDelete()" style="display: none; margin-left: 10px;">Supprimer</button>
            </form>
        </div>
    </div>

    <script src="config.js"></script>

    <script>
        /**
         * Fonction centralisée pour appeler l'API backend via POST.
         * @param {string} action - Le nom de l'action à exécuter côté serveur.
         * @param {Object} [data={}] - Un objet contenant les données à envoyer.
         * @returns {Promise<Object>} Une promesse qui se résout avec la réponse JSON de l'API.
         */
        function callApi(action, data = {}) {
            const formData = new FormData();
            const token = localStorage.getItem('authToken');
            if (!token && action !== 'loginUser' && action !== 'registerUser') {
                // Si pas de token et que l'action n'est pas une connexion/inscription, rediriger.
                window.location.href = 'Connexion.html';
            }
            formData.append('action', action);

            // Ajouter chaque clé de l'objet data au FormData
            for (const key in data) {
                // Si la valeur est un objet, la stringifier en JSON
                const value = typeof data[key] === 'object' ? JSON.stringify(data[key]) : data[key];
                formData.append(key, value);
            }
            formData.append('token', token); // Ajouter le token à chaque requête !

            return fetch(API_URL, { method: 'POST', body: formData }).then(res => res.json());
        }

        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const mainContent = document.querySelector('.main-content');
            const menuToggle = document.querySelector('.menu-toggle');
            
            const isCollapsed = sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('collapsed', isCollapsed);
            menuToggle.classList.toggle('collapsed', isCollapsed);

            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('visible');
            }

            // Sauvegarder l'état dans le localStorage
            localStorage.setItem('sidebarCollapsed', isCollapsed);
        }

        // Au chargement de la page, vérifier l'état sauvegardé
        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('sidebarCollapsed') === 'true' && window.innerWidth > 768) {
                toggleSidebar();
            }
            // Appliquer le thème sauvegardé ou Auto
            const savedTheme = localStorage.getItem('theme');
            const systemPrefersLight = window.matchMedia('(prefers-color-scheme: light)').matches;
            
            if (savedTheme === 'light' || (!savedTheme && systemPrefersLight)) {
                document.body.classList.add('light-mode');
                const btn = document.getElementById('theme-toggle-btn');
                if(btn) btn.textContent = 'Passer au mode sombre';
            }
        });

        function toggleTheme() {
            const isLight = document.body.classList.toggle('light-mode');
            const themeToggleBtn = document.getElementById('theme-toggle-btn');
            if (isLight) {
                localStorage.setItem('theme', 'light');
                themeToggleBtn.textContent = 'Passer au mode sombre';
            } else {
                localStorage.setItem('theme', 'dark');
                themeToggleBtn.textContent = 'Passer au mode clair';
            }
        }

        function showPane(event, paneId, clickedElement) {
            event.preventDefault(); // Empêche le comportement par défaut du lien

            const targetPane = document.getElementById(paneId);
            if (targetPane) {
                // Fait défiler la vue jusqu'au panneau cible
                targetPane.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            // Met à jour l'état "actif" dans la barre latérale pour indiquer la section visible
            document.querySelectorAll('.sidebar nav a').forEach(link => link.classList.remove('active'));
            clickedElement.classList.add('active');

            // Sur mobile, refermer la barre latérale après avoir cliqué sur un lien
            if (window.innerWidth <= 768) {
                document.querySelector('.sidebar').classList.remove('visible');
            }
        }

        function toggleModule(moduleName, isEnabled) {
            const dataToSave = {};
            // Convertit le booléen en 'OUI' ou 'NON' pour la feuille de calcul
            dataToSave[moduleName] = isEnabled ? 'OUI' : 'NON';

            // Affiche un message rapide pour informer l'utilisateur
            alert("Sauvegarde du paramètre...");

            callApi('saveProfile', dataToSave)
                .then(response => {
                    if (response.success) {
                        alert('Paramètre sauvegardé avec succès !');
                    } else {
                        alert('Erreur : ' + (response.error || 'Impossible de sauvegarder le paramètre.'));
                        // En cas d'erreur, on remet l'interrupteur à son état précédent
                        const checkbox = document.getElementById('toggle-lead');
                        checkbox.checked = !isEnabled;
                    }
                })
                .catch(err => {
                    alert('Erreur de communication avec le serveur.');
                    const checkbox = document.getElementById('toggle-lead');
                    checkbox.checked = !isEnabled;
                });
        }

        function addSocialLink(type = 'website', url = '') {
            const container = document.getElementById('social-links-container');
            const newLinkEntry = document.createElement('div');
            newLinkEntry.className = 'social-link-entry';

            const uniqueId = 'social_' + Date.now();

            const selectHTML = `
                <select class="form-control" name="social_type_${uniqueId}" onchange="updatePhoneSocialLinks()">
                    <option value="website" ${type === 'website' ? 'selected' : ''}>Site Web</option>
                    <option value="linkedin" ${type === 'linkedin' ? 'selected' : ''}>LinkedIn</option>
                    <option value="github" ${type === 'github' ? 'selected' : ''}>GitHub</option>
                    <option value="twitter" ${type === 'twitter' ? 'selected' : ''}>X (Twitter)</option>
                    <option value="instagram" ${type === 'instagram' ? 'selected' : ''}>Instagram</option>
                    <option value="facebook" ${type === 'facebook' ? 'selected' : ''}>Facebook</option>
                    <option value="tiktok" ${type === 'tiktok' ? 'selected' : ''}>TikTok</option>
                    <option value="youtube" ${type === 'youtube' ? 'selected' : ''}>YouTube</option>
                    <option value="whatsapp" ${type === 'whatsapp' ? 'selected' : ''}>WhatsApp</option>
                    <option value="telegram" ${type === 'telegram' ? 'selected' : ''}>Telegram</option>
                    <option value="snapchat" ${type === 'snapchat' ? 'selected' : ''}>Snapchat</option>
                    <option value="other" ${type === 'other' ? 'selected' : ''}>Lien personnalisé</option>
                </select>
            `;

            newLinkEntry.innerHTML = `
                ${selectHTML}
                <input type="text" class="form-control" name="social_url_${uniqueId}" placeholder="Ex: instagram.com/profil" value="${url}" oninput="updatePhoneSocialLinks()">
                <button type="button" class="btn btn-danger" onclick="this.parentElement.remove(); updatePhoneSocialLinks();">✕</button>
            `;
            container.appendChild(newLinkEntry);
        }

        function addServiceField(title = '', desc = '') {
            const container = document.getElementById('services-container');
            const newServiceEntry = document.createElement('div');
            newServiceEntry.className = 'service-entry';
            newServiceEntry.style.marginBottom = '15px';
            newServiceEntry.style.border = '1px solid var(--border-color)';
            newServiceEntry.style.padding = '10px';
            newServiceEntry.style.borderRadius = '5px';
            newServiceEntry.innerHTML = `
                <div class="form-group"><label>Titre du service</label><input type="text" class="form-control service-title" value="${title}" placeholder="Ex: Développement Web"></div>
                <div class="form-group"><label>Description</label><textarea class="form-control service-desc" placeholder="Ex: Création de sites vitrines...">${desc}</textarea></div>
                <button type="button" class="btn btn-danger" onclick="this.parentElement.remove()">Supprimer ce service</button>
            `;
            container.appendChild(newServiceEntry);
        }

        function handleSave(event) {
            event.preventDefault();
            const button = document.getElementById('save-button');
            button.textContent = 'Sauvegarde en cours...';
            button.disabled = true;

            const profileForm = document.getElementById('profile-form');

            const profileData = {
                // Panneau "À propos"
                Nom_Complet: profileForm.Nom_Complet.value,
                URL_Profil: profileForm.URL_Profil.value, // Ajout du nouveau champ
                Email: profileForm.Email.value,
                Telephone: profileForm.Telephone.value,
                Profession: profileForm.Profession.value,
                Compagnie: profileForm.Compagnie.value,
                Location: profileForm.Location.value,

                // Panneau "Apparence"
                Mise_En_Page: profileForm.Mise_En_Page.value,
                // Police: profileForm.Police.value, // Champ Police n'existe pas dans le HTML
                Couleur_Theme: profileForm.Couleur_Theme.value, // Nouveau champ
                Cacher_Marque: document.getElementById('toggle-branding').checked,
                Langue: profileForm.Langue.value,

                // Panneau "Liens"
                Liens_Sociaux_JSON: getSocialLinksData(),
                Services_JSON: getServicesData()

                // La configuration du Wallet est maintenant gérée côté serveur, plus besoin de l'envoyer depuis le client.
            };
            
            // La gestion des images se fait maintenant via handleDirectImageChange
            // Il n'y a plus de fichiers à uploader depuis ce formulaire.
            // On sauvegarde directement les autres données.
            saveDataToSheet(profileData, button);
        }

        function uploadToImgBB(file) {
            return new Promise((resolve, reject) => {
                const apiKey = '96ff1e4e9603661db4d410f53df99454'; // Clé API ImgBB directement dans le code
                const formData = new FormData();
                formData.append('image', file);

                fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        resolve(result.data.url);
                    } else {
                        reject(new Error('Erreur ImgBB: ' + result.error.message));
                    }
                })
                .catch(reject);
            });
        }

        /**
         * Affiche ou cache le menu d'édition pour les images.
         */
        function toggleEditMenu(event, menuId) {
            event.preventDefault();
            event.stopPropagation();
            const menu = document.getElementById(menuId);
            // Cache tous les autres menus ouverts
            document.querySelectorAll('.edit-dropdown-menu').forEach(m => {
                if (m.id !== menuId) m.style.display = 'none';
            });
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }

        // Ferme les menus si on clique ailleurs
        window.addEventListener('click', () => {
            document.querySelectorAll('.edit-dropdown-menu').forEach(m => m.style.display = 'none');
        });

        /**
         * Déclenche le clic sur un input file caché.
         */
        function triggerFileInput(inputId) {
            event.preventDefault();
            document.getElementById(inputId).click();
        }

        /**
         * Gère le changement d'image depuis l'aperçu et lance la sauvegarde.
         */
        function handleDirectImageChange(event, type) {
            const file = event.target.files[0];
            if (!file) return;

            // Mettre à jour l'aperçu
            const previewUrl = URL.createObjectURL(file);
            if (type === 'picture') {
                document.getElementById('profile-picture-preview').src = previewUrl;
            } else {
                document.getElementById('profile-cover-preview').style.backgroundImage = `url('${previewUrl}')`;
            }

            // Uploader et sauvegarder
            alert('Mise à jour de l\'image en cours...');
            uploadToImgBB(file).then(url => {
                // Utilise la nouvelle fonction avec le format attendu par le backend
                saveImageData(type, url);
            }).catch(err => alert("Erreur d'upload: " + err.message));
        }

        function deleteImage(event, type) {
            event.preventDefault();
            if (!confirm("Voulez-vous vraiment supprimer cette image ?")) return;
            // Utilise la nouvelle fonction en passant une URL vide pour supprimer
            saveImageData(type, '');
        }

        function exportLeads() {
            // TODO: Implémenter la logique d'exportation des prospects en CSV.
            alert("La fonctionnalité d'exportation en CSV est en cours de développement.");
        }

        // Fonction dédiée à la sauvegarde des données d'image via la nouvelle action
        function saveImageData(imageType, imageUrl) {
            const payload = { imageType: imageType, imageUrl: imageUrl };
            callApi('saveProfileImage', { payload: payload })
                .then(response => {
                    alert(response.error || response.message || 'Image sauvegardée !');
                    fetchDashboardData(); // Recharger les données pour afficher la nouvelle image
                })
                .catch(err => alert('Erreur de sauvegarde de l\'image: ' + (err.message || "Erreur inconnue")));
        }

        function saveDataToSheet(data, button) {
            const saveButton = button || document.getElementById('save-button'); // Utilise le bouton passé ou le bouton par défaut
            if (saveButton) {
                saveButton.textContent = 'Sauvegarde en cours...';
                saveButton.disabled = true;
            }
            callApi('saveProfile', data) // Envoyer directement l'objet de données sans les infos Wallet
                .then(response => {
                    alert(response.error || response.message || 'Profil sauvegardé !');
                    closeModal('profil-edit-modal');
                    fetchDashboardData(); // Recharger les données
                })
                .catch(err => alert('Erreur de sauvegarde: ' + (err.message || "Erreur inconnue")))
                .finally(() => {
                    if (saveButton) { saveButton.textContent = 'Sauvegarder les changements'; saveButton.disabled = false; }
                });
        }

        // --- Gestion des Documents (Mode Disque) ---
        function handleDocUpload(event, type) {
            const file = event.target.files[0];
            if (!file) return;

            // Feedback immédiat
            const originalText = event.target.previousElementSibling.innerHTML;
            if (type.startsWith('card')) {
                event.target.previousElementSibling.innerHTML = '<span class="spin">↻</span>';
            }

            alert("Envoi du document en cours vers le coffre-fort...");

            uploadToImgBB(file).then(url => {
                const docName = file.name;
                const payload = { 
                    type: type, 
                    url: url, 
                    name: docName,
                    date: new Date().toISOString()
                };

                callApi('saveDocument', { payload: payload })
                    .then(response => {
                        if(response.success) {
                            alert('Document sécurisé avec succès !');
                            fetchDashboardData(); // Rafraîchir l'affichage
                        } else {
                            alert('Erreur lors de la sécurisation : ' + response.error);
                        }
                    })
                    .catch(err => alert('Erreur serveur : ' + err.message))
                    .finally(() => {
                         if (type.startsWith('card')) event.target.previousElementSibling.innerHTML = originalText;
                    });
            }).catch(err => {
                alert("Erreur d'upload : " + err.message);
                if (type.startsWith('card')) event.target.previousElementSibling.innerHTML = originalText;
            });
        }

        function deleteDocument(docId) {
            if(!confirm("Supprimer ce document définitivement ?")) return;
            callApi('deleteDocument', { docId: docId })
                .then(() => fetchDashboardData())
                .catch(err => alert("Erreur : " + err.message));
        }
    </script>

    <!-- Intégration de Chart.js et appel à Apps Script -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script>
        let viewsChartInstance = null; // Variable pour stocker l'instance du graphique
        let currentUser = null; // Variable globale pour stocker l'utilisateur courant

        document.addEventListener('DOMContentLoaded', function() {
            fetchDashboardData();
            feather.replace();
        });

        function fetchDashboardData() {
            callApi('getDashboardData')
                .then(populateDashboard) // populateDashboard gère déjà les erreurs renvoyées par l'API
                .catch(onDashboardError); // Gère les erreurs réseau ou les problèmes de parsing JSON
        }


        function onDashboardError(error) {
            console.error("Erreur de chargement du dashboard:", error.message);
            // Affiche un message plus utile à l'utilisateur
            alert("Impossible de charger les données du tableau de bord. Erreur : " + error.message);
            // On n'affiche plus d'alerte à l'utilisateur pour une meilleure expérience.
            // Les erreurs sont visibles dans la console pour le débogage.
        }

        /**
         * Anime un nombre de start à end sur une durée donnée.
         */
        function animateValue(id, start, end, duration) {
            const obj = document.getElementById(id);
            if (!obj) return;
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.textContent = Math.floor(progress * (end - start) + start);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        /**
         * Cache les squelettes de chargement à l'intérieur d'un conteneur spécifique.
         * @param {string} containerSelector - Le sélecteur CSS du conteneur (ex: '#profil-content').
         */
        function hideSkeletons(containerSelector) {
            document.querySelectorAll(`${containerSelector} .skeleton, ${containerSelector} .skeleton-row`).forEach(el => el.style.display = 'none');
        }
        function populateDashboard(data) {
            if (!data || data.error) {
                onDashboardError({ message: data ? data.error : "Aucune donnée reçue du serveur." });
                return;
            }

            // Sécurisation des objets de données pour éviter les erreurs null/undefined
            const user = data.user || {};
            const profile = data.profile || {};
            const enterprise = data.enterprise || {}; // Données entreprise
            const prospects = data.prospects || [];
            const documents = data.documents || []; // Nouveaux documents

            currentUser = user; // Stocker pour usage global

            // --- GESTION DES RÔLES ---
            if (user.Role === 'Entreprise' || user.Role === 'Admin' || user.Role === 'Particulier') {
                document.body.classList.add('role-entreprise');
                
                // Masquer l'onglet Équipe pour les Particuliers car ils sont seuls
                if (user.Role === 'Particulier') {
                    const teamNav = document.getElementById('nav-team');
                    if (teamNav) teamNav.style.display = 'none';
                }
            } else {
                document.body.classList.add('role-employe');
            }

            // --- Remplir le panneau d'aperçu du profil ---
            const baseUrl = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);
            const fullUrl = `${baseUrl}ProfilePublic.html?user=${user.URL_Profil || ''}`;

            // Aperçu
            document.getElementById('profile-picture-preview').src = profile.URL_Photo || 'https://placehold.co/150x150/333/ccc?text=Profil';
            document.getElementById('profile-cover-preview').style.backgroundImage = `url('${profile.URL_Couverture || 'https://placehold.co/800x300/333/ccc?text=Couverture'}')`;
            document.getElementById('profile-name-preview').textContent = profile.Nom_Complet || user.Email || 'Utilisateur';
            const subtitleParts = [profile.Profession, profile.Compagnie, profile.Location].filter(Boolean);
            document.getElementById('profile-details-preview').textContent = subtitleParts.join(' | ');

            // Actions de partage
            // Utilisation de quickchart.io pour un QR code avec logo. On construit l'URL absolue du logo.
            const logoUrl = new URL('r/logo.png', window.location.href).href;
            document.getElementById('profile-qrcode').src = `https://quickchart.io/qr?text=${encodeURIComponent(fullUrl)}&logo=${logoUrl}&size=250&centerImage=true`;
            document.getElementById('phone-qrcode-preview').src = `https://quickchart.io/qr?text=${encodeURIComponent(fullUrl)}&size=150`;
            
            // Générer le lien de téléchargement en haute résolution
            const highResQrUrl = `https://quickchart.io/qr?text=${encodeURIComponent(fullUrl)}&logo=${logoUrl}&size=1024&format=png&centerImage=true`;
            document.getElementById('download-qrcode-btn').href = highResQrUrl;
            document.getElementById('share-qr-dl').href = highResQrUrl;
            
            // Bouton Voir le profil
            document.getElementById('view-profile-btn').onclick = () => window.open(fullUrl, '_blank');

            document.getElementById('share-copy-btn').onclick = () => { navigator.clipboard.writeText(fullUrl); alert('Lien copié !'); };
            document.getElementById('share-email').href = `mailto:?subject=Découvrez mon profil Brunel&body=Voici mon profil numérique : ${fullUrl}`;
            document.getElementById('share-sms').href = `sms:?&body=Voici mon profil numérique : ${fullUrl}`;
            document.getElementById('share-facebook').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(fullUrl)}`;
            document.getElementById('share-whatsapp').href = `https://wa.me/?text=${encodeURIComponent(fullUrl)}`;
            document.getElementById('share-linkedin').href = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(fullUrl)}`;
            
            // Fonction de partage natif pour "Plus", Instagram et TikTok
            const shareNative = () => {
                if (navigator.share) {
                    navigator.share({ title: 'Mon Profil Mahu', url: fullUrl }).catch(console.error);
                } else {
                    navigator.clipboard.writeText(fullUrl); alert('Lien copié ! Partagez-le où vous voulez.');
                }
            };
            document.getElementById('share-plus-btn').onclick = shareNative;
            document.getElementById('share-instagram').onclick = shareNative;
            document.getElementById('share-tiktok').onclick = shareNative;

            // Barre de progression
            let completeness = 0;
            if (profile.Nom_Complet) completeness += 20;
            if (profile.URL_Photo) completeness += 20;
            if (profile.URL_Couverture) completeness += 20;
            if (subtitleParts.length > 0) completeness += 20;
            if (JSON.parse(profile.Liens_Sociaux_JSON || '[]').length > 0) completeness += 20;
            document.getElementById('profile-completeness-percent').textContent = `${completeness}%`;
            document.getElementById('profile-completeness-bar').style.width = `${completeness}%`;


            // Remplir l'éditeur de profil
            // Panneau "À propos"
            document.getElementById('Nom_Complet').value = profile.Nom_Complet || '';
            document.getElementById('URL_Profil').value = user.URL_Profil || ''; // Remplir le champ URL
            document.getElementById('Email').value = profile.Email || user.Email || '';
            document.getElementById('Telephone').value = profile.Telephone || '';
            document.getElementById('Profession').value = profile.Profession || '';
            document.getElementById('Compagnie').value = profile.Compagnie || '';
            document.getElementById('Location').value = profile.Location || '';
            // Panneau "Apparence"
            // Remplir les champs d'apparence avec les données sauvegardées (ou des valeurs par défaut)
            document.querySelector('select[name="Mise_En_Page"]').value = profile.Mise_En_Page || 'default';
            document.getElementById('Couleur_Theme').value = profile.Couleur_Theme || '#007BFF';

            // Remplir l'aperçu du téléphone
            document.getElementById('phone-picture-preview').src = profile.URL_Photo || 'https://placehold.co/150x150/333/ccc?text=Profil';
            document.getElementById('phone-cover-preview').style.backgroundImage = `url('${profile.URL_Couverture || 'https://placehold.co/800x300/333/ccc?text=Couverture'}')`;
            document.getElementById('phone-name-preview').textContent = profile.Nom_Complet || 'Nom non défini';
            document.getElementById('phone-name-preview').textContent = profile.Nom_Complet || user.Email || 'Utilisateur';
            const phoneSubtitleParts = [profile.Profession, profile.Compagnie, profile.Location].filter(Boolean);
            document.getElementById('phone-details-preview').textContent = phoneSubtitleParts.join(' | ');
            updatePhoneContactInfo(profile.Telephone, profile.Email || user.Email);

            document.querySelector('.phone-header img').style.borderColor = profile.Couleur_Theme || 'var(--accent-color)'; // Utilise la couleur du thème
            document.getElementById('phone-picture-preview').style.borderColor = profile.Couleur_Theme || 'var(--accent-color)'; // CORRECTIF : Utilise l'ID de l'image
            
            // Remplir les liens sociaux dans l'éditeur
            updatePhoneSocialLinks(); // Mettre à jour l'aperçu

            document.getElementById('social-links-container').innerHTML = ''; // Vider avant de remplir
            const socialLinks = JSON.parse(profile.Liens_Sociaux_JSON || '[]');
            socialLinks.forEach(link => {
                addSocialLink(link.type, link.url);
            });

            // Remplir les services
            document.getElementById('services-container').innerHTML = '';
            const services = JSON.parse(profile.Services_JSON || '[]');
            services.forEach(svc => {
                addServiceField(svc.title, svc.description);
            });

            // Remplir les infos entreprise (si dispo)
            if (enterprise && user.Role === 'Entreprise') {
                document.getElementById('display-enterprise-name').textContent = enterprise.Name || user.Compagnie || 'Non défini';
                document.getElementById('display-enterprise-phone').textContent = enterprise.Phone || '';
                document.getElementById('display-enterprise-address').textContent = enterprise.Address || '';
                document.getElementById('edit-enterprise-name').value = enterprise.Name || user.Compagnie || '';
                document.getElementById('edit-enterprise-phone').value = enterprise.Phone || '';
                document.getElementById('edit-enterprise-address').value = enterprise.Address || '';
            }

            // Remplir la liste de l'équipe (si Entreprise)
            if (user.Role === 'Entreprise' && data.team) {
                const teamBody = document.getElementById('team-table-body');
                teamBody.innerHTML = '';
                data.team.forEach(member => {
                    teamBody.innerHTML += `
                        <tr><td>${member.name}</td><td>${member.email}</td><td>${member.leads}</td>
                        <td><a href="ProfilePublic.html?user=${member.url}" target="_blank" class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.8em;">Voir</a>
                        <button class="btn btn-danger" onclick="deleteEmployee('${member.email}')" style="padding: 5px 10px; font-size: 0.8em; margin-left: 5px;">Supprimer</button></td></tr>`;
                });
            }

            // Remplir la table des prospects
            const prospectsBody = document.getElementById('prospects-table-body');
            prospectsBody.innerHTML = ''; // Vider le contenu précédent

            if (prospects.length > 0) {
                prospects.forEach(p => {
                    prospectsBody.innerHTML += `<tr><td>${p.nom || ''}</td><td>${p.contact || ''}</td><td>${new Date(p.date).toLocaleDateString()}</td><td>${p.note || ''}</td></tr>`;
                });
            } else {
                prospectsBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Aucun prospect pour le moment.</td></tr>';
            }

            // Remplir la section Documents
            const cardFront = documents.find(d => d.type === 'card_front');
            const cardBack = documents.find(d => d.type === 'card_back');
            
            if (cardFront) {
                document.getElementById('card-front-preview').style.backgroundImage = `url('${cardFront.url}')`;
                document.getElementById('card-front-preview').innerHTML = ''; // Enlever le texte
            }
            if (cardBack) {
                document.getElementById('card-back-preview').style.backgroundImage = `url('${cardBack.url}')`;
                document.getElementById('card-back-preview').innerHTML = '';
            }

            const docList = document.getElementById('important-docs-list');
            docList.innerHTML = '';
            const otherDocs = documents.filter(d => d.type === 'document');
            if (otherDocs.length > 0) {
                otherDocs.forEach(doc => {
                    docList.innerHTML += `
                        <li class="doc-item">
                            <div class="doc-item-info"><span class="doc-icon">📄</span> <a href="${doc.url}" target="_blank" style="color:var(--text-primary); text-decoration:none;">${doc.name}</a></div>
                            <button class="btn btn-danger" onclick="deleteDocument('${doc.id}')" style="padding: 5px 10px;">Supprimer</button>
                        </li>`;
                });
            } else {
                docList.innerHTML = '<li style="color: var(--text-secondary); padding: 10px;">Aucun document important.</li>';
            }

            // Mettre à jour les toggles des modules
            if (document.getElementById('toggle-lead')) document.getElementById('toggle-lead').checked = profile.Lead_Capture_Actif === 'OUI';

            // Remplir le statut de commande
            const orderStatusEl = document.getElementById('order-status');
            if (data.lastOrder) {
                const dateStr = new Date(data.lastOrder.date).toLocaleDateString();
                orderStatusEl.innerHTML = `<span style="color: var(--accent-color); font-weight: bold;">${data.lastOrder.status}</span> - ${data.lastOrder.product} <span style="font-size: 0.8em; color: var(--text-secondary);">(${dateStr})</span>`;
            } else {
                orderStatusEl.textContent = "Aucune commande récente.";
            }

            // Remplir les paramètres
            document.getElementById('account-email').textContent = user.Email || 'Non disponible';

            // Cacher les squelettes uniquement pour les panneaux qui ont été remplis
            hideSkeletons('#profil-content');
            hideSkeletons('#contact-content');
            hideSkeletons('#statistique-content');
            hideSkeletons('#documents-content');
            hideSkeletons('#parametre-content');
            hideSkeletons('#blog-content');

            // --- Remplir les statistiques et dessiner le graphique ---
            if (data.stats) {
                drawChart(data.stats);
            } else {
                onChartError({ message: "Données de statistiques non trouvées." });
            }
            animateValue('stats-total-views', 0, data.totalViews ?? 0, 2000);
            animateValue('stats-total-prospects', 0, data.totalProspects ?? 0, 2000);
        }

        function getSocialLinksData() {
            const container = document.getElementById('social-links-container');
            const entries = container.querySelectorAll('.social-link-entry');
            const links = [];
            entries.forEach(entry => {
                const type = entry.querySelector('select').value;
                const url = entry.querySelector('input[type="text"]').value;
                if (url) {
                    links.push({ type, url });
                }
            });
            return JSON.stringify(links);
        }

        function getServicesData() {
            const container = document.getElementById('services-container');
            const entries = container.querySelectorAll('.service-entry');
            const services = [];
            entries.forEach(entry => {
                const title = entry.querySelector('.service-title').value;
                const description = entry.querySelector('.service-desc').value;
                if (title) services.push({ title, description });
            });
            return JSON.stringify(services);
        }

        /**
         * Dessine le graphique une fois les données reçues de Google Sheets.
         * @param {object} stats - L'objet contenant {labels: [...], data: [...]}.
         */
        function drawChart(stats) {
            if (stats.error) {
                onChartError({ message: stats.error });
                return;
            }

            // Mettre à jour les chiffres dans les cartes de statistiques (basé sur le graphique des 7 derniers jours)
            const nfcIndex = stats.labels.indexOf('NFC');
            const qrIndex = stats.labels.indexOf('QR Code');
            const linkIndex = stats.labels.indexOf('Lien');
            animateValue('stats-nfc-views', 0, nfcIndex !== -1 ? stats.data[nfcIndex] : 0, 1500);
            animateValue('stats-qr-views', 0, qrIndex !== -1 ? stats.data[qrIndex] : 0, 1500);
            animateValue('stats-link-views', 0, linkIndex !== -1 ? stats.data[linkIndex] : 0, 1500);

            const ctx = document.getElementById('viewsChart').getContext('2d');
            
            if (viewsChartInstance) {
                viewsChartInstance.destroy(); // Détruire l'ancienne instance du graphique
            }

            viewsChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: stats.labels,
                    datasets: [{
                        label: 'Vues par source',
                        data: stats.data,
                        backgroundColor: 'rgba(128, 128, 128, 0.5)',
                        borderColor: 'rgba(128, 128, 128, 0.8)',
                        hoverBackgroundColor: 'rgba(128, 128, 128, 0.7)',
                        hoverBorderColor: 'rgba(128, 128, 128, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { 
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'var(--card-bg)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.y || 0;
                                    const plural = value > 1 ? 's' : '';
                                    return `${value} vue${plural} via ${context.label}`;
                                }
                            }
                        }
                    },
                    scales: { 
                        y: { 
                            beginAtZero: true,
                            ticks: { color: 'var(--text-secondary)' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { color: 'var(--text-secondary)' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }

        function onChartError(error) {
            console.error("Erreur lors de la récupération des données du graphique :", error.message);
            document.getElementById('viewsChart').parentElement.innerHTML += '<p style="color: var(--red);">Impossible de charger le graphique.</p>';
        }

        // Fonctions pour la modale
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Fonction pour la navigation dans la modale d'édition
        function showEditPane(paneId, clickedElement) {
            document.querySelectorAll('.edit-pane').forEach(pane => pane.classList.remove('active'));
            document.getElementById(paneId).classList.add('active');
            document.querySelectorAll('.editor-nav-btn').forEach(btn => btn.classList.remove('active'));
            clickedElement.classList.add('active');
        }

        function updatePhoneContactInfo(phone, email) {
            const phoneContainer = document.getElementById('phone-number-container');
            const emailContainer = document.getElementById('email-address-container');
            
            document.getElementById('phone-number-preview').textContent = phone || '';
            phoneContainer.style.display = phone ? 'flex' : 'none'; // Flex pour le nouveau design

            document.getElementById('email-address-preview').textContent = email || '';
            emailContainer.style.display = email ? 'flex' : 'none';
        }

        // Fonctions pour l'aperçu en direct
        document.getElementById('Nom_Complet').addEventListener('input', e => {
            document.getElementById('phone-name-preview').textContent = e.target.value || 'Nom Prénom';
        });
        document.getElementById('Telephone').addEventListener('input', e => updatePhoneContactInfo(e.target.value, document.getElementById('Email').value));
        document.getElementById('Email').addEventListener('input', e => updatePhoneContactInfo(document.getElementById('Telephone').value, e.target.value));

        document.getElementById('Profession').addEventListener('input', updatePhoneDetails);
        document.getElementById('Compagnie').addEventListener('input', updatePhoneDetails);
        document.getElementById('Location').addEventListener('input', updatePhoneDetails);

        // Ajout des écouteurs pour l'aperçu en direct des couleurs et polices
        document.getElementById('Couleur_Theme').addEventListener('input', e => {
            const themeColor = e.target.value;
            document.getElementById('phone-picture-preview').style.borderColor = themeColor;
            // Mettre à jour l'aperçu des boutons sociaux en direct
        });

        function updatePhoneDetails() {
            const parts = [document.getElementById('Profession').value, document.getElementById('Compagnie').value, document.getElementById('Location').value].filter(Boolean);
            document.getElementById('phone-details-preview').textContent = parts.join(' | ') || 'Profession';
        }

        function updatePhoneSocialLinks() {
            const container = document.getElementById('social-links-container');
            const previewContainer = document.getElementById('phone-social-links-preview');
            previewContainer.innerHTML = '';

            // Récupérer les couleurs actuelles des boutons pour l'aperçu
            const themeColor = document.getElementById('Couleur_Theme').value;
            const buttonTextColor = 'white'; // Texte blanc sur la couleur du thème pour les boutons

            const entries = container.querySelectorAll('.social-link-entry');
            // Nouvelle table de correspondance pour vos logos SVG
            const iconMap = {
                twitter: 'r/logo/1.svg',   // X
                linkedin: 'r/logo/2.svg',  // ln
                tiktok: 'r/logo/3.svg',    // tiktok
                youtube: 'r/logo/4.svg',   // youtube
                instagram: 'r/logo/5.svg', // instagramme
                whatsapp: 'r/logo/6.svg',  // whtasapp
                telegram: 'r/logo/7.svg',  // telegrame
                facebook: 'r/logo/8.svg',  // faceboo
                snapchat: 'r/logo/9.svg'   // sanpp
            };

            entries.forEach(entry => {
                const type = entry.querySelector('select').value;
                const url = entry.querySelector('input[type="text"]').value.trim();
                if (url) {
                    const iconSrc = iconMap[type]; // Récupère le chemin de votre SVG
                    const linkName = entry.querySelector('select').options[entry.querySelector('select').selectedIndex].text;
                    
                    // Utilise une balise <img> si un logo personnalisé existe
                    const iconHtml = iconSrc ? `<img src="${iconSrc}" class="social-icon">` : '';

                    previewContainer.innerHTML += `
                        <a href="#" class="phone-social-link" style="display: flex; align-items: center; gap: 15px; padding: 10px; background-color: rgba(0,0,0,0.2); border-radius: 8px; text-decoration: none; color: #adb5bd;">
                            <div style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">${iconHtml}</div>
                            <span style="font-size: 0.9em;">${linkName}</span>
                        </a>
                    `;
                }
            });
        }

        function logout() {
            callApi('logout')
                .then(() => localStorage.removeItem('authToken')) // Supprimer le token
                .finally(() => window.location.href = 'index.html');
        }

    </script>
</body>
</html> 