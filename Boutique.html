<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Boutique - Mahu</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Cartes Produit spécifiques */
        .product-card .price {
            font-size: 2em;
            font-weight: bold;
            margin: 20px 0;
        }
        .price span {
            font-size: 0.5em;
            font-weight: normal;
            color: var(--text-secondary);
        } 

        /* Carrousel d'images amélioré dans la carte produit */
        .product-carousel {
            position: relative;
            width: 100%;
            height: 180px;
            border-radius: 8px;
            overflow: hidden;
            margin: -30px -30px 20px -30px; /* Pour toucher les bords */
            background-color: #e0e0e0; /* Fond par défaut */
        }
        .carousel-inner {
            display: flex;
            height: 100%;
            width: 400%; /* 100% par image, 4 images */
            transition: transform 0.5s ease-in-out;
        }
        .carousel-item {
            width: 25%; /* 100% / 4 images */
            height: 100%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
            box-sizing: border-box;
        }
        .carousel-btn {
            background-color: rgba(255, 255, 255, 0.7);
            border: none;
            color: var(--text-primary);
            font-size: 1.5em;
            cursor: pointer;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .product-carousel:hover .carousel-btn {
            opacity: 1;
        }

        /* Styles simplifiés pour le fond du carrousel (thème noir/blanc) */
        .pvc-style { background-color: #e0e0e0; }
        .metal-style { background-color: #333333; }
        .wood-style { background-color: #d7ccc8; }
        .sticker-style { background-color: #f5f5f5; }

        /* Superposition du design de la carte (transparent) */
        .card-design-overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 2;
        }

        /* Superposition du logo Mahu sur chaque carte */
        .mahu-logo-overlay {
            position: absolute;
            top: 15px; left: 20px;
            width: 45px;
            height: auto;
            z-index: 4;
            opacity: 0.8;
            filter: brightness(0); /* Logo Mahu en noir par défaut */
        }

        /* Bouton Retour en Haut */
        #back-to-top {
            position: fixed;
            bottom: 30px;
            right: 20px;
            background-color: var(--blue);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            text-align: center;
            font-size: 24px;
            line-height: 50px;
            cursor: pointer;
            display: none; /* Caché par défaut */
            z-index: 999;
        }

        /* Responsive */
        @media (max-width: 992px) {
            nav ul.desktop-links { display: none; }
            .nav-actions a.primary { display: none; }
            .menu-burger { display: block; }
            .section-title {
                font-size: 2.2em;
            }

            nav ul, .nav-contact-info { display: none; }

            .menu-burger { display: block; }
        }
    </style>
</head>
<body>
    <header>
        <nav class="container">
            <a href="index.html" class="logo"><img src="r/logo.png" alt="Logo Mahu"></a>
            <ul class="desktop-links">
                <li><a href="index.html#platform-features">Nos Services</a></li>
                <li><a href="Boutique.html" style="font-weight: bold;">Boutique</a></li>
                <li><a href="index.html#about">À Propos</a></li>
            </ul>
            <div class="nav-actions">
                <a href="Panier.html" id="cart-link">Panier (0)</a>
                <a href="Connexion.html" class="primary" id="login-link">Connexion</a>
                <div class="menu-burger" onclick="toggleMobileMenu()">☰</div>
            </div>
        </nav>
    </header>

    <div class="nav-links-mobile">
        <a href="index.html#platform-features" onclick="toggleMobileMenu()">Nos Services</a>
        <a href="Boutique.html" onclick="toggleMobileMenu()">Boutique</a>
        <a href="index.html#about" onclick="toggleMobileMenu()">À Propos</a>
        <a href="Connexion.html" onclick="toggleMobileMenu()" class="primary">Connexion</a>
        <a href="Panier.html" onclick="toggleMobileMenu()" id="mobile-cart-link">Panier (0)</a>
    </div>

    <main>
        <section class="container">
            <h1 class="section-title">Notre Boutique</h1>
            <p class="section-subtitle">Choisissez la carte qui vous représente. Chaque carte est équipée de la technologie NFC et donne un accès à vie à notre plateforme de gestion.</p>

            <div class="grid-3">
                <div class="card product-card">
                    <div class="product-carousel">
                        <button class="carousel-btn prev" onclick="navigateCarousel(this, -1)">&#10094;</button>
                        <div class="carousel-inner">
                            <div class="carousel-item pvc-style" style="background: #1a1a1a;">
                                <img src="r/v/1.svg" class="card-design-overlay"><img src="r/logo.png" class="mahu-logo-overlay" style="filter: invert(1);">
                            </div>
                            <div class="carousel-item pvc-style" style="background: #f0f0f0;">
                                <img src="r/v/2.svg" class="card-design-overlay"><img src="r/logo.png" class="mahu-logo-overlay">
                            </div>
                            <div class="carousel-item pvc-style" style="background: #cccccc;">
                                <img src="r/v/3.svg" class="card-design-overlay"><img src="r/logo.png" class="mahu-logo-overlay">
                            </div>
                            <div class="carousel-item pvc-style" style="background: #ffffff;">
                                <img src="r/v/4.svg" class="card-design-overlay"><img src="r/logo.png" class="mahu-logo-overlay">
                            </div>
                        </div>
                        <button class="carousel-btn next" onclick="navigateCarousel(this, 1)">&#10095;</button>
                    </div>
                    <h3>Carte Classique PVC</h3>
                    <p>La carte en PVC premium, durable et élégante. Personnalisable avec votre logo et QR code. Le standard de l'efficacité.</p>
                    <div class="price">29.99€ <span>/ unité</span></div>
                    <a href="#" class="btn" onclick="addToCart('pvc', 'Carte Classique PVC', 29.99); return false;">Ajouter au Panier</a>
                </div>
                <div class="card product-card">
                    <div class="product-carousel">
                        <button class="carousel-btn prev" onclick="navigateCarousel(this, -1)">&#10094;</button>
                        <div class="carousel-inner">
                            <div class="carousel-item metal-style" style="background: #111111;"> <!-- Noir Mat -->
                                <img src="r/v/2.svg" class="card-design-overlay"><img src="r/logo.png" class="mahu-logo-overlay" style="filter: invert(1);">
                            </div>
                            <div class="carousel-item metal-style" style="background: #333333;"> <!-- Noir brossé -->
                                <img src="r/v/1.svg" class="card-design-overlay"><img src="r/logo.png" class="mahu-logo-overlay" style="filter: invert(1);">
                            </div>
                            <div class="carousel-item metal-style" style="background: #e0e0e0;"> <!-- Argent -->
                                <img src="r/v/3.svg" class="card-design-overlay"><img src="r/logo.png" class="mahu-logo-overlay">
                            </div>
                            <div class="carousel-item metal-style" style="background: #f5f5f5;"> <!-- Blanc -->
                                <img src="r/v/4.svg" class="card-design-overlay"><img src="r/logo.png" class="mahu-logo-overlay">
                            </div>
                        </div>
                        <button class="carousel-btn next" onclick="navigateCarousel(this, 1)">&#10095;</button>
                    </div>
                    <h3>Carte Métal Noir</h3>
                    <p>Une finition luxueuse en métal brossé noir pour un impact maximal. Gravure laser de précision pour un rendu inoubliable.</p>
                    <div class="price">79.99€ <span>/ unité</span></div>
                    <a href="#" class="btn" onclick="addToCart('metal', 'Carte Métal', 79.99); return false;">Ajouter au Panier</a>
                </div>
                <div class="card product-card">
                    <div class="product-carousel">
                        <button class="carousel-btn prev" onclick="navigateCarousel(this, -1)">&#10094;</button>
                        <div class="carousel-inner">
                            <div class="carousel-item wood-style" style="background-color: #d7ccc8;"> <!-- Bambou -->
                                <img src="r/v/1.svg" class="card-design-overlay"><img src="r/logo.png" class="mahu-logo-overlay">
                            </div>
                            <div class="carousel-item wood-style" style="background-color: #a1887f;"> <!-- Bois foncé -->
                                <img src="r/v/2.svg" class="card-design-overlay"><img src="r/logo.png" class="mahu-logo-overlay" style="filter: invert(1);">
                            </div>
                            <div class="carousel-item wood-style" style="background-color: #efebe9;"> <!-- Bois clair -->
                                <img src="r/v/3.svg" class="card-design-overlay"><img src="r/logo.png" class="mahu-logo-overlay">
                            </div>
                            <div class="carousel-item wood-style" style="background-color: #8d6e63;"> <!-- Bois cerisier -->
                                <img src="r/v/4.svg" class="card-design-overlay"><img src="r/logo.png" class="mahu-logo-overlay" style="filter: invert(1);">
                            </div>
                        </div>
                        <button class="carousel-btn next" onclick="navigateCarousel(this, 1)">&#10095;</button>
                    </div>
                    <h3>Carte Bois de Bambou</h3>
                    <p>Écologique et unique, chaque carte en bois de bambou véritable est une pièce d'artisanat. Pour ceux qui veulent se démarquer durablement.</p>
                    <div class="price">59.99€ <span>/ unité</span></div>
                    <a href="#" class="btn" onclick="addToCart('wood', 'Carte Bois', 59.99); return false;">Ajouter au Panier</a>
                </div>
                 <div class="card product-card">
                    <div class="product-carousel sticker-style" style="display: flex; align-items: center; justify-content: center; background-color: #f5f5f5;">
                        <img src="r/v/4.svg" style="height: 120px; width: auto;">
                    </div>
                    <h3>Sticker NFC</h3>
                    <p>Transformez n'importe quel objet en carte de visite. Collez ce sticker discret au dos de votre téléphone et partagez vos infos instantanément.</p>
                    <div class="price">19.99€ <span>/ unité</span></div>
                    <a href="#" class="btn" onclick="addToCart('sticker', 'Sticker NFC', 19.99); return false;">Ajouter au Panier</a>
                </div>
                 <div class="card product-card">
                    <!-- Pour le pack, on peut montrer une seule image ou un montage -->
                    <div class="product-carousel" style="height: 180px; background: #e0e0e0; display: flex; align-items: center; justify-content: center;">
                        <img src="r/v/1.svg" style="height: 120px; width: auto;">
                    </div>
                    <h3>Pack Équipe (10 Cartes)</h3>
                    <p>Équipez toute votre équipe avec nos cartes classiques. Gestion centralisée des profils depuis un seul tableau de bord administrateur.</p>
                    <div class="price">249.99€ <span>/ pack</span></div>
                    <a href="#" class="btn" onclick="addToCart('pack10', 'Pack Équipe (10 Cartes)', 249.99); return false;">Ajouter au Panier</a>
                </div>
            </div>
        </section>
    </main>

    <div id="back-to-top" onclick="scrollToTop()">&#8679;</div>

    <script src="config.js"></script>

    <script>
        /**
         * ===================================================================
         *                        SCRIPT CENTRALISÉ
         * ===================================================================
         * Les fonctions communes sont définies ici pour éviter la répétition.
         * Fonction centralisée pour appeler l'API backend via POST.
         */
        function callApi(action, data = {}) {
            const formData = new FormData();
            formData.append('action', action);
            for (const key in data) {
                const value = typeof data[key] === 'object' ? JSON.stringify(data[key]) : data[key];
                formData.append(key, value);
            }
            return fetch(API_URL, { method: 'POST', body: formData }).then(res => res.json());
        }

        /**
         * Ajoute un produit au panier (localStorage) et synchronise si l'utilisateur est connecté.
         */
        function addToCart(id, name, price) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            const existingItem = cart.find(item => item.id === id);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ id, name, price, quantity: 1 });
            }
            localStorage.setItem('cart', JSON.stringify(cart));
            alert(name + ' a été ajouté au panier !');
            // Si l'utilisateur est connecté, synchroniser le panier avec le backend
            if (localStorage.getItem('userIsLoggedIn') === 'true') {
                callApi('syncCart', { payload: cart }).catch(err => console.error('Erreur de synchro panier:', err));
            }
            updateCartCounter();
        }

        /**
         * Gère l'affichage du menu mobile.
         */
        function toggleMobileMenu() {
            const mobileMenu = document.querySelector('.nav-links-mobile');
            const burgerIcon = document.querySelector('.menu-burger');
            const body = document.body;

            mobileMenu.classList.toggle('active');
            body.classList.toggle('no-scroll');

            if (mobileMenu.classList.contains('active')) {
                burgerIcon.innerHTML = '✕'; // Icône de fermeture
            } else {
                burgerIcon.innerHTML = '☰';
            }
        }

        /**
         * Met à jour le compteur d'articles dans le header.
         */
        function updateCartCounter() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-link').textContent = `Panier (${totalItems})`;
            document.getElementById('mobile-cart-link').textContent = `Panier (${totalItems})`;
        }

        function navigateCarousel(button, direction) {
            const carousel = button.closest('.product-carousel');
            const inner = carousel.querySelector('.carousel-inner');
            const itemsCount = inner.children.length;
            let index = parseInt(carousel.dataset.index);

            index += direction;

            if (index < 0) {
                index = itemsCount - 1;
            } else if (index >= itemsCount) {
                index = 0;
            }

            carousel.dataset.index = index;
            inner.style.transform = `translateX(-${index * (100 / itemsCount)}%)`;
        }

        // ===================================================================
        //                  SCRIPTS SPÉCIFIQUES À LA PAGE
        // ===================================================================

        // Logique pour les carrousels
        document.querySelectorAll('.product-carousel').forEach(carousel => { carousel.dataset.index = 0; });
        // Logique pour le bouton "Retour en Haut"
        const backToTopButton = document.getElementById('back-to-top');
        window.onscroll = function() {
            if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
                backToTopButton.style.display = "block";
            } else {
                backToTopButton.style.display = "none";
            }
        };
        function scrollToTop() {
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        /**
         * Logique exécutée au chargement du DOM.
         */
        document.addEventListener('DOMContentLoaded', () => {
            updateCartCounter();
        });

    </script>
</body>
</html>